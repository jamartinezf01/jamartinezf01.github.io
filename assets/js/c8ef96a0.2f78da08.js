"use strict";(self.webpackChunkp_my_dm=self.webpackChunkp_my_dm||[]).push([[157],{651:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/Ejemplo Tabl\xf3n de Anuncios","title":"Ejemplo Tabl\xf3n de Anuncios","description":"En este tutorial crearemos la aplicaci\xf3n \\"tal\xf3n de anuncios\\", realizada previamente con el servicio Realtime Database, empleando Firestore...","source":"@site/docs/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/Ejemplo Tabl\xf3n de Anuncios.md","sourceDirName":"aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore","slug":"/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/Ejemplo Tabl\xf3n de Anuncios","permalink":"/docs/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/Ejemplo Tabl\xf3n de Anuncios","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10}}');var s=r(4848),a=r(8453);const o={sidebar_position:10},l="Ejemplo Tabl\xf3n de Anuncios",c={},t=[{value:"1. <strong>Creaci\xf3n del Proyecto y Configuraci\xf3n Inicial</strong>",id:"1-creaci\xf3n-del-proyecto-y-configuraci\xf3n-inicial",level:2},{value:"2. <strong>Estructura del Proyecto (MVVM y Paquetes)</strong>",id:"2-estructura-del-proyecto-mvvm-y-paquetes",level:2},{value:"3. <strong>Modificaciones en el modelo</strong>",id:"3-modificaciones-en-el-modelo",level:2},{value:"4. <strong>Reglas de Seguridad en FIrestore</strong>",id:"4-reglas-de-seguridad-en-firestore",level:2},{value:"Reglas b\xe1sicas",id:"reglas-b\xe1sicas",level:3},{value:"Opci\xf3n m\xe1s abierta: Permitir lectura p\xfablica",id:"opci\xf3n-m\xe1s-abierta-permitir-lectura-p\xfablica",level:3},{value:"<strong>Prueba la aplicaci\xf3n</strong>",id:"prueba-la-aplicaci\xf3n",level:2}];function d(e){const n={admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"ejemplo-tabl\xf3n-de-anuncios",children:"Ejemplo Tabl\xf3n de Anuncios"})}),"\n",(0,s.jsxs)(n.p,{children:["En este tutorial crearemos la aplicaci\xf3n ",(0,s.jsx)(n.strong,{children:'"tal\xf3n de anuncios"'}),", realizada previamente con el servicio Realtime Database, ",(0,s.jsx)(n.strong,{children:"empleando Firestore"}),"..."]}),"\n",(0,s.jsx)("div",{style:{margin:"0 auto",width:"250px"},children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Presentaci\xf3n de la 1\xaa version de la app Tabl\xf3n de Anuncios",src:r(3995).A+"",title:"Presentaci\xf3n de la 1\xaa version de la app de Tabl\xf3n de Anuncios",width:"356",height:"797"})})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"1-creaci\xf3n-del-proyecto-y-configuraci\xf3n-inicial",children:["1. ",(0,s.jsx)(n.strong,{children:"Creaci\xf3n del Proyecto y Configuraci\xf3n Inicial"})]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Crear un proyecto"})," en Android Studio:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Selecciona ",(0,s.jsx)(n.strong,{children:"Empty Activity"})," (o Basic Activity)."]}),"\n",(0,s.jsxs)(n.li,{children:["Aseg\xfarate de que el ",(0,s.jsx)(n.strong,{children:"lenguaje"})," sea ",(0,s.jsx)(n.strong,{children:"Java"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Indica un ",(0,s.jsx)(n.strong,{children:"Package name"})," apropiado (p. ej. ",(0,s.jsx)(n.code,{children:"com.ejemplo.tablon"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"M\xednimo SDK: 28 (o el que prefieras)."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Activar el soporte para ViewBinding"}),": en el ",(0,s.jsx)(n.code,{children:"build.gradle"})," (M\xf3dulo: app), dentro de ",(0,s.jsx)(n.code,{children:"android {}"}),", a\xf1ade:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"buildFeatures {\r\n    viewBinding true\r\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configura"})," tu proyecto para emplear ",(0,s.jsx)(n.em,{children:"Autentication"})," y ",(0,s.jsx)(n.em,{children:"Firestore"})," del modo visto en apartados anteriores"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sincroniza"})," el proyecto para que se apliquen los cambios."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"2-estructura-del-proyecto-mvvm-y-paquetes",children:["2. ",(0,s.jsx)(n.strong,{children:"Estructura del Proyecto (MVVM y Paquetes)"})]}),"\n",(0,s.jsx)(n.p,{children:"A continuaci\xf3n se describe una estructura para una aplicaci\xf3n Android (Java) que cumple los siguientes requisitos:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Un ",(0,s.jsx)(n.strong,{children:"Activity de Registro"})," donde el usuario se registra con ",(0,s.jsx)(n.strong,{children:"Email y Password"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Una ",(0,s.jsx)(n.strong,{children:"Activity Principal"})," con ",(0,s.jsx)(n.strong,{children:"un Fragment"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TablonFragment"}),": Muestra los anuncios y permite publicar uno nuevo."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Se utiliza ",(0,s.jsx)(n.strong,{children:"un solo Repositorio"})," y ",(0,s.jsx)(n.strong,{children:"un solo ViewModel"})," que ser\xe1n compartidos."]}),"\n",(0,s.jsxs)(n.li,{children:["Arquitectura b\xe1sica  ",(0,s.jsx)(n.strong,{children:"MVVM"})," (aunque simplificada)."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"La idea principal es la misma que en el caso de implementaci\xf3n anterior:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TablonRepository"}),": Accede a Firebase (Auth + Realtime Database)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TablonViewModel"}),": Provee m\xe9todos y LiveData para autenticaci\xf3n y anuncios."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RegistroActivity"}),": Pantalla de registro de usuario."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"MainActivity"}),": Hospeda un Fragment (TablonFragment) y comparte el ",(0,s.jsx)(n.strong,{children:"mismo"})," ",(0,s.jsx)(n.code,{children:"TablonViewModel"}),". Esto permitir\xe1 agregar m\xe1s fragments en el futuro."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Una posible estructura de paquetes ser\xeda la siguiente..."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"com.ejemplo.tablon\r\n \u2523 model\r\n \u2503 \u2523 Anuncio.java\r\n \u2503 \u2517 TablonRepository.java\r\n \u2523 ui\r\n \u2503 \u2523 TablonViewModel.java\r\n \u2503 \u2523 TablonFragment.java\r\n \u2503 \u2517 AnunciosAdapter.java\r\n \u2523 MainActivity.java\r\n \u2517 RegistroActivity.java\r\n\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Puedes ajustar la organizaci\xf3n a tu preferencia, pero esta forma te ayuda a mantener el Repositorio, el ViewModel y las Activities/Fragments separados."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Reutilizaci\xf3n de C\xf3digo",type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Para la actividad ",(0,s.jsx)(n.strong,{children:"RegstroActivity"})," y su ",(0,s.jsx)(n.strong,{children:"layOut"})," emplearemos el c\xf3digo visto en el ",(0,s.jsx)(n.strong,{children:"Ejemplo de Firebase Autentication"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Para la actividad ",(0,s.jsx)(n.strong,{children:"MainActivity"})," y su ",(0,s.jsx)(n.strong,{children:"layOut"})," emplearemos el c\xf3digo visto en el ",(0,s.jsx)(n.strong,{children:"Ejemplo de Firebase RealTime Database"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Todo el pakage UI queda sin alterarse, gracias al modelo MVVM que separa la implementaci\xf3n de la UI del modelo de datos."}),"\n",(0,s.jsxs)(n.li,{children:["Para el modelo reutilizaremos la clase ",(0,s.jsx)(n.strong,{children:"Anuncio"})]}),"\n"]})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"3-modificaciones-en-el-modelo",children:["3. ",(0,s.jsx)(n.strong,{children:"Modificaciones en el modelo"})]}),"\n",(0,s.jsxs)(n.p,{children:["Del proyecto original con Realtime ",(0,s.jsx)(n.strong,{children:"deberemos modificar el Repositorio"})," que es el que mantiene la l\xf3gica de comunicaci\xf3n con la base de datos. Para ello deberemos emplear la ",(0,s.jsx)(n.strong,{children:"l\xf3gica de Firestore"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",metastring:'title="com/ejemplo/tablon/model/TablonRepository.java"',children:'package com.agora.tablonfirestore.model;\r\n\r\nimport androidx.annotation.NonNull;\r\n\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.database.*;\r\n\r\nimport com.google.firebase.firestore.*;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Calendar;\r\nimport java.util.List;\r\n\r\npublic class TablonRepository {\r\n\r\n    public interface AuthCallback {\r\n        void onSuccess();\r\n        void onFailure(String error);\r\n    }\r\n\r\n    public interface AnunciosCallback {\r\n        void onSuccess(List<Anuncio> lista);\r\n        void onFailure(String error);\r\n    }\r\n\r\n    private final FirebaseAuth mAuth;\r\n    private final FirebaseFirestore db;\r\n    private final CollectionReference anunciosRef;\r\n\r\n    public TablonRepository() {\r\n        mAuth = FirebaseAuth.getInstance();\r\n        db = FirebaseFirestore.getInstance();\r\n        anunciosRef = db.collection("anuncios"); // Referencia a la colecci\xf3n de Firestore\r\n    }\r\n\r\n    public FirebaseUser getUsuarioActual() {\r\n        return mAuth.getCurrentUser();\r\n    }\r\n\r\n    // Publicar un anuncio\r\n    public void publicarAnuncio(String contenido, AuthCallback callback) {\r\n        FirebaseUser user = getUsuarioActual();\r\n        if (user == null) {\r\n            callback.onFailure("No hay usuario autenticado");\r\n            return;\r\n        }\r\n\r\n        // Generar un ID autom\xe1tico en Firestore\r\n        DocumentReference newAnuncioRef = anunciosRef.document();\r\n\r\n        Anuncio anuncio = new Anuncio(newAnuncioRef.getId(), contenido, System.currentTimeMillis(), user.getEmail());\r\n\r\n        newAnuncioRef.set(anuncio)\r\n                .addOnSuccessListener(aVoid -> callback.onSuccess())\r\n                .addOnFailureListener(e -> callback.onFailure(e.getMessage()));\r\n    }\r\n\r\n    // Leer todos los anuncios ordenados por fecha (del m\xe1s reciente al m\xe1s antiguo)\r\n    public void leerAnuncios(AnunciosCallback callback) {\r\n        anunciosRef.orderBy("fecha", Query.Direction.DESCENDING)\r\n                .limit(50) // Limita a los \xfaltimos 50 anuncios\r\n                .addSnapshotListener((querySnapshot, e) -> {\r\n                    if (e != null) {\r\n                        callback.onFailure(e.getMessage());\r\n                        return;\r\n                    }\r\n\r\n                    List<Anuncio> lista = new ArrayList<>();\r\n                    if (querySnapshot != null) {\r\n                        for (DocumentSnapshot doc : querySnapshot.getDocuments()) {\r\n                            Anuncio an = doc.toObject(Anuncio.class);\r\n                            if (an != null) lista.add(an);\r\n                        }\r\n                    }\r\n                    callback.onSuccess(lista);\r\n                });\r\n    }\r\n\r\n    // Eliminar un anuncio\r\n    public void eliminarAnuncio(String id, AuthCallback callback) {\r\n        FirebaseUser user = getUsuarioActual();\r\n        if (user == null) {\r\n            callback.onFailure("No hay usuario autenticado");\r\n            return;\r\n        }\r\n\r\n        anunciosRef.document(id).delete()\r\n                .addOnSuccessListener(aVoid -> callback.onSuccess())\r\n                .addOnFailureListener(e -> callback.onFailure(e.getMessage()));\r\n    }\r\n\r\n    // B\xfasqueda b\xe1sica de anuncios por contenido\r\n    public void buscarAnuncios(String texto, AnunciosCallback callback) {\r\n        anunciosRef.whereEqualTo("contenido", texto)\r\n                .get()\r\n                .addOnSuccessListener(querySnapshot -> {\r\n                    List<Anuncio> resultados = new ArrayList<>();\r\n                    for (DocumentSnapshot doc : querySnapshot.getDocuments()) {\r\n                        Anuncio an = doc.toObject(Anuncio.class);\r\n                        if (an != null) resultados.add(an);\r\n                    }\r\n                    callback.onSuccess(resultados);\r\n                })\r\n                .addOnFailureListener(e -> callback.onFailure(e.getMessage()));\r\n    }\r\n\r\n\r\n    //Consulta m\xe1s compleja: Buscar anuncios de un usuario en los \xfaltimos 7 d\xedas\r\n    public void buscarAnunciosRecientesDeUsuario(String emailUsuario, AnunciosCallback callback) {\r\n        // Obtener el timestamp de hace 7 d\xedas\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.add(Calendar.DAY_OF_YEAR, -7);\r\n        long fechaLimite = calendar.getTimeInMillis();\r\n\r\n        // Firestore query: filtrar por usuario y fecha\r\n        anunciosRef\r\n                .whereEqualTo("uidAutor", emailUsuario) // Buscar solo los anuncios de este usuario\r\n                .whereGreaterThan("fecha", fechaLimite) // Solo anuncios de los \xfaltimos 7 d\xedas\r\n                .orderBy("fecha", Query.Direction.DESCENDING) // Ordenar por fecha, de m\xe1s reciente a m\xe1s antiguo\r\n                .get()\r\n                .addOnSuccessListener(querySnapshot -> {\r\n                    List<Anuncio> resultados = new ArrayList<>();\r\n                    for (DocumentSnapshot doc : querySnapshot.getDocuments()) {\r\n                        Anuncio an = doc.toObject(Anuncio.class);\r\n                        if (an != null) resultados.add(an);\r\n                    }\r\n                    callback.onSuccess(resultados);\r\n                })\r\n                .addOnFailureListener(e -> callback.onFailure(e.getMessage()));\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{title:"\xbfQu\xe9 cambios se han hecho?",type:"note",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Base de datos:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DatabaseReference"})," \u2192 ",(0,s.jsxs)(n.strong,{children:["Reemplazado por ",(0,s.jsx)(n.code,{children:"CollectionReference"})," en Firestore."]})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"addValueEventListener()"})," \u2192 ",(0,s.jsxs)(n.strong,{children:["Reemplazado por ",(0,s.jsx)(n.code,{children:"addSnapshotListener()"})," para lectura en tiempo real."]})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Publicaci\xf3n de anuncios:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["En lugar de ",(0,s.jsx)(n.code,{children:"push().getKey()"}),", Firestore ",(0,s.jsx)(n.strong,{children:"genera autom\xe1ticamente un ID"})," con ",(0,s.jsx)(n.code,{children:"document().getId()"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Eliminaci\xf3n de anuncios:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Se usa ",(0,s.jsx)(n.code,{children:"document(id).delete()"})," en lugar de ",(0,s.jsx)(n.code,{children:"removeValue()"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"B\xfasqueda:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Se usa ",(0,s.jsx)(n.code,{children:'whereEqualTo("contenido", texto).get()'})," en lugar de ",(0,s.jsx)(n.code,{children:"orderByChild().startAt().endAt()"}),"."]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Las funciones ",(0,s.jsx)(n.code,{children:"buscarAnuncios()"})," y ",(0,s.jsx)(n.code,{children:"buscarAnunciosRecientesDeUsuario()"})," se han creado a modo de ejemplos de consultas aunque no se emplear\xe1 en este proyecto."]})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"4-reglas-de-seguridad-en-firestore",children:["4. ",(0,s.jsx)(n.strong,{children:"Reglas de Seguridad en FIrestore"})]}),"\n",(0,s.jsxs)(n.p,{children:["Para asegurar tu nueva aplicaci\xf3n en ",(0,s.jsx)(n.strong,{children:"Firestore"}),", necesitas definir ",(0,s.jsx)(n.strong,{children:"Reglas de Seguridad"})," en ",(0,s.jsx)(n.strong,{children:"Firebase Console"})," (Secci\xf3n: Firestore Database \u2192 Rules). Estas reglas deben:\r\n\u2705 ",(0,s.jsx)(n.strong,{children:"Proteger los datos"})," para que solo los usuarios autenticados puedan leer y escribir.",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Evitar que los usuarios eliminen o editen anuncios de otros"}),".",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Permitir la lectura p\xfablica si es necesario"})," o restringirla seg\xfan necesidades."]}),"\n",(0,s.jsx)(n.h3,{id:"reglas-b\xe1sicas",children:"Reglas b\xe1sicas"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    \r\n    // Reglas para la colecci\xf3n \"anuncios\"\r\n    match /anuncios/{anuncioId} {\r\n      \r\n      // Solo los usuarios autenticados pueden leer los anuncios\r\n      allow read: if request.auth != null;\r\n      \r\n      // Solo los usuarios autenticados pueden publicar anuncios\r\n      allow create: if request.auth != null;\r\n      \r\n      // Solo el usuario que cre\xf3 el anuncio puede modificarlo o eliminarlo\r\n      allow update, delete: if request.auth != null && request.auth.token.email == resource.data.uidAutor;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.admonition,{title:"Explicaci\xf3n de las reglas",type:"note",children:[(0,s.jsxs)(n.p,{children:["1\ufe0f\u20e3 ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"allow read: if request.auth != null;"})})]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Solo los usuarios autenticados pueden ",(0,s.jsx)(n.strong,{children:"ver los anuncios"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["\u274c ",(0,s.jsx)(n.strong,{children:"Si un usuario no est\xe1 autenticado, Firestore rechazar\xe1 la consulta"}),"."]}),"\n"]}),(0,s.jsxs)(n.p,{children:["2\ufe0f\u20e3 ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"allow create: if request.auth != null;"})})]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Solo los usuarios autenticados pueden ",(0,s.jsx)(n.strong,{children:"publicar anuncios"}),"."]}),"\n"]}),(0,s.jsxs)(n.p,{children:["3\ufe0f\u20e3 ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"allow update, delete: if request.auth.token.email == resource.data.uidAutor;"})})]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Un usuario solo puede ",(0,s.jsx)(n.strong,{children:"editar o eliminar su propio anuncio"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Compara el email del usuario autenticado (",(0,s.jsx)(n.code,{children:"request.auth.token.email"}),") con el email del autor (",(0,s.jsx)(n.code,{children:"resource.data.uidAutor"}),")"]}),"."]}),"\n"]})]}),"\n",(0,s.jsx)(n.h3,{id:"opci\xf3n-m\xe1s-abierta-permitir-lectura-p\xfablica",children:"Opci\xf3n m\xe1s abierta: Permitir lectura p\xfablica"}),"\n",(0,s.jsxs)(n.p,{children:["Si quieres que ",(0,s.jsx)(n.strong,{children:"cualquiera pueda ver los anuncios sin autenticaci\xf3n"}),", pero solo los creadores puedan escribir o modificar:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    \r\n    match /anuncios/{anuncioId} {\r\n      \r\n      // Cualquiera puede leer los anuncios (incluso sin autenticarse)\r\n      allow read: if true;\r\n\r\n      // Solo usuarios autenticados pueden escribir\r\n      allow create: if request.auth != null;\r\n      \r\n      // Solo el usuario que cre\xf3 el anuncio puede modificarlo o eliminarlo\r\n      allow update, delete: if request.auth != null && request.auth.token.email == resource.data.uidAutor;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"\xdatil si tu app es p\xfablica y cualquiera debe ver los anuncios sin iniciar sesi\xf3n."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"prueba-la-aplicaci\xf3n",children:(0,s.jsx)(n.strong,{children:"Prueba la aplicaci\xf3n"})}),"\n",(0,s.jsx)(n.p,{children:"Felicidades \ud83d\udc4f\ud83c\udffd\ud83d\udc4f\ud83c\udffd. En este punto deber\xedas tener una App que permitapublicar anuncios en Firestore. Ahora a\xf1adiremos nuevas funcionalidades \ud83d\ude80"})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},3995:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/Tablon_v1-2244938589a14abfaf217f929df8422b.gif"},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(6540);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);