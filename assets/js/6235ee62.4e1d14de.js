"use strict";(self.webpackChunkp_my_dm=self.webpackChunkp_my_dm||[]).push([[1157],{7280:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"python/UT7 - Persistencia/7.3 BBDD/7.3.2_crud_sqlite","title":"7.3.2 CRUD con SQLite","description":"Una vez que tenemos nuestra estructura de tablas, necesitamos saber c\xf3mo interactuar con los datos. En el mundo de la persistencia, esto se resume en las siglas CRUD: Create (Crear), Read (Leer), Update (Actualizar) y Delete (Borrar).","source":"@site/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.2_crud_sqlite.md","sourceDirName":"python/UT7 - Persistencia/7.3 BBDD","slug":"/python/UT7 - Persistencia/7.3 BBDD/7.3.2_crud_sqlite","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.2_crud_sqlite","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"pythonSidebar","previous":{"title":"7.3.1 Introducci\xf3n a SQLite","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.1_intro_sqlite"},"next":{"title":"7.3.3 Consultas Avanzadas y Agregaci\xf3n","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.3_consultas_sqlite"}}');var a=s(4848),o=s(8453);const i={sidebar_position:3},c="7.3.2 CRUD con SQLite",l={},t=[{value:"<strong>1\ufe0f\u20e3 Insertar Datos (CREATE)</strong>",id:"1\ufe0f\u20e3-insertar-datos-create",level:2},{value:"\ud83d\udfe9 Inserci\xf3n segura con par\xe1metros",id:"-inserci\xf3n-segura-con-par\xe1metros",level:3},{value:"\ud83d\udfe6 Inserciones masivas con <code>executemany()</code>",id:"-inserciones-masivas-con-executemany",level:3},{value:"<strong>2\ufe0f\u20e3 Consultar Datos (READ)</strong>",id:"2\ufe0f\u20e3-consultar-datos-read",level:2},{value:"\ud83d\udfe9 El cursor como iterador",id:"-el-cursor-como-iterador",level:3},{value:"\ud83d\udfe6 <code>fetchone()</code> y <code>fetchall()</code>",id:"-fetchone-y-fetchall",level:3},{value:"<strong>3\ufe0f\u20e3 Actualizar y Borrar (UPDATE &amp; DELETE)</strong>",id:"3\ufe0f\u20e3-actualizar-y-borrar-update--delete",level:2},{value:"\ud83d\udfe9 Actualizaci\xf3n selectiva",id:"-actualizaci\xf3n-selectiva",level:3},{value:"\ud83d\udfe6 Borrado de registros",id:"-borrado-de-registros",level:3},{value:"\ud83d\udfe8 <code>cursor.rowcount</code>: \xbfHa pasado algo?",id:"-cursorrowcount-ha-pasado-algo",level:3},{value:"<strong>\u2705 Reglas de Oro del CRUD</strong>",id:"-reglas-de-oro-del-crud",level:2},{value:"<strong>\ud83e\uddea Ejercicios pr\xe1cticos</strong> \u2013 Misi\xf3n: La Cripta de Datos (Parte 2)",id:"-ejercicios-pr\xe1cticos--misi\xf3n-la-cripta-de-datos-parte-2",level:2},{value:"\ud83d\udfe2 Fase 1 \u2013 El Gran Ingreso",id:"-fase-1--el-gran-ingreso",level:3},{value:"\ud83d\udfe9 Ejercicio 1 \u2013 El Primer Manuscrito",id:"-ejercicio-1--el-primer-manuscrito",level:4},{value:"\ud83d\udfe6 Ejercicio 2 \u2013 La Caravana de Libros",id:"-ejercicio-2--la-caravana-de-libros",level:4},{value:"\ud83d\udfe8 Ejercicio 3 \u2013 Importaci\xf3n Masiva (CSV)",id:"-ejercicio-3--importaci\xf3n-masiva-csv",level:4},{value:"\ud83d\udfe1 Fase 2 \u2013 Auditor\xeda de Estanter\xedas",id:"-fase-2--auditor\xeda-de-estanter\xedas",level:3},{value:"\ud83d\udfe7 Ejercicio 4 \u2013 El Buscador",id:"-ejercicio-4--el-buscador",level:4},{value:"\ud83d\udfeb Ejercicio 5 \u2013 Espacio en las estanter\xedas",id:"-ejercicio-5--espacio-en-las-estanter\xedas",level:4},{value:"\ud83d\udd34 Fase 3 \u2013 Mantenimiento Preventivo",id:"-fase-3--mantenimiento-preventivo",level:3},{value:"\ud83d\udfe5 Ejercicio 5 \u2013 Restauraci\xf3n de Tomos",id:"-ejercicio-5--restauraci\xf3n-de-tomos",level:4},{value:"\ud83d\udfea Ejercicio 6 \u2013 El Informe de la Cripta",id:"-ejercicio-6--el-informe-de-la-cripta",level:4}];function d(e){const r={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"732-crud-con-sqlite",children:"7.3.2 CRUD con SQLite"})}),"\n",(0,a.jsxs)(r.p,{children:["Una vez que tenemos nuestra estructura de tablas, necesitamos saber c\xf3mo interactuar con los datos. En el mundo de la persistencia, esto se resume en las siglas ",(0,a.jsx)(r.strong,{children:"CRUD"}),": ",(0,a.jsx)(r.strong,{children:"C"}),"reate (Crear), ",(0,a.jsx)(r.strong,{children:"R"}),"ead (Leer), ",(0,a.jsx)(r.strong,{children:"U"}),"pdate (Actualizar) y ",(0,a.jsx)(r.strong,{children:"D"}),"elete (Borrar)."]}),"\n",(0,a.jsx)(r.p,{children:"Dominar estas cuatro operaciones es dominar la gesti\xf3n de la informaci\xf3n de cualquier aplicaci\xf3n profesional."}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"1\ufe0f\u20e3-insertar-datos-create",children:(0,a.jsx)(r.strong,{children:"1\ufe0f\u20e3 Insertar Datos (CREATE)"})}),"\n",(0,a.jsx)(r.p,{children:"Insertar datos no es solo meter texto en una tabla; es asegurar que la informaci\xf3n entra de forma segura y eficiente."}),"\n",(0,a.jsx)(r.h3,{id:"-inserci\xf3n-segura-con-par\xe1metros",children:"\ud83d\udfe9 Inserci\xf3n segura con par\xe1metros"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Nunca"}),' uses f-strings o concatenaci\xf3n para meter variables en una consulta SQL. Esto abre la puerta a ataques de "Inyecci\xf3n SQL". Usa siempre marcadores de posici\xf3n (',(0,a.jsx)(r.code,{children:"?"}),")."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'nombre = "El Quijote"\nautor = "Cervantes"\npaginas = 863\n\ncursor.execute(\n    "INSERT INTO libros (titulo, autor, paginas) VALUES (?, ?, ?)",\n    (nombre, autor, paginas)\n)\n'})}),"\n",(0,a.jsx)(r.admonition,{title:"ojo",type:"warning",children:(0,a.jsxs)(r.p,{children:["Nota que los valores se pasan como una ",(0,a.jsx)(r.strong,{children:"tupla"})," en el segundo argumento de ",(0,a.jsx)(r.code,{children:"execute()"}),". Si solo pasas un valor, debe ser ",(0,a.jsx)(r.code,{children:"(valor,)"}),"."]})}),"\n",(0,a.jsxs)(r.h3,{id:"-inserciones-masivas-con-executemany",children:["\ud83d\udfe6 Inserciones masivas con ",(0,a.jsx)(r.code,{children:"executemany()"})]}),"\n",(0,a.jsxs)(r.p,{children:["Si tienes una lista de cientos de registros, llamar a ",(0,a.jsx)(r.code,{children:"execute()"})," en un bucle es muy lento (por el overhead de comunicaci\xf3n con el motor). ",(0,a.jsx)(r.code,{children:"executemany()"})," est\xe1 optimizado para esto."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'nuevos_libros = [\n    ("Moby Dick", "Herman Melville", 635),\n    ("1984", "George Orwell", 328),\n    ("Dr\xe1cula", "Bram Stoker", 418)\n]\n\ncursor.executemany(\n    "INSERT INTO libros (titulo, autor, paginas) VALUES (?, ?, ?)", \n    nuevos_libros\n)\n'})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"2\ufe0f\u20e3-consultar-datos-read",children:(0,a.jsx)(r.strong,{children:"2\ufe0f\u20e3 Consultar Datos (READ)"})}),"\n",(0,a.jsx)(r.p,{children:'Extraer informaci\xf3n es la operaci\xf3n m\xe1s com\xfan. SQLite nos ofrece varias formas de "recoger" los resultados que devuelve el cursor.'}),"\n",(0,a.jsx)(r.h3,{id:"-el-cursor-como-iterador",children:"\ud83d\udfe9 El cursor como iterador"}),"\n",(0,a.jsx)(r.p,{children:"Para archivos grandes, lo m\xe1s eficiente es recorrer el cursor directamente."}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'cursor.execute("SELECT titulo, autor FROM libros")\n\nfor fila in cursor:\n    print(f"Libro: {fila[0]} - Autor: {fila[1]}")\n'})}),"\n",(0,a.jsxs)(r.h3,{id:"-fetchone-y-fetchall",children:["\ud83d\udfe6 ",(0,a.jsx)(r.code,{children:"fetchone()"})," y ",(0,a.jsx)(r.code,{children:"fetchall()"})]}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"fetchone()"})}),": Devuelve la siguiente fila o ",(0,a.jsx)(r.code,{children:"None"})," si no hay m\xe1s. Ideal para b\xfasquedas por ID."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"fetchall()"})}),": Devuelve una lista con todas las filas. Cuidado: carga todo en la memoria RAM."]}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'cursor.execute("SELECT * FROM libros WHERE id = ?", (1,))\nlibro = cursor.fetchone()\n\nif libro:\n    print(f"Encontrado: {libro[\'titulo\']}")\n'})}),"\n",(0,a.jsx)(r.admonition,{title:"Recordatorio",type:"tip",children:(0,a.jsxs)(r.p,{children:["Si activaste ",(0,a.jsx)(r.code,{children:"conn.row_factory = sqlite3.Row"})," en la conexi\xf3n, podr\xe1s acceder por nombre de columna: ",(0,a.jsx)(r.code,{children:"libro['titulo']"}),". Si no, tendr\xe1s que usar \xedndices: ",(0,a.jsx)(r.code,{children:"libro[1]"}),"."]})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"3\ufe0f\u20e3-actualizar-y-borrar-update--delete",children:(0,a.jsx)(r.strong,{children:"3\ufe0f\u20e3 Actualizar y Borrar (UPDATE & DELETE)"})}),"\n",(0,a.jsxs)(r.p,{children:["Estas operaciones son potentes pero peligrosas. Un error en la cl\xe1usula ",(0,a.jsx)(r.code,{children:"WHERE"})," puede vaciar o estropear toda una tabla."]}),"\n",(0,a.jsx)(r.h3,{id:"-actualizaci\xf3n-selectiva",children:"\ud83d\udfe9 Actualizaci\xf3n selectiva"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'# Cambiar el estado de un libro espec\xedfico\ncursor.execute(\n    "UPDATE libros SET estado = ? WHERE id = ?", \n    ("prestado", 15)\n)\n'})}),"\n",(0,a.jsx)(r.h3,{id:"-borrado-de-registros",children:"\ud83d\udfe6 Borrado de registros"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'# Eliminar libros muy cortos\ncursor.execute("DELETE FROM libros WHERE paginas < ?", (50,))\n'})}),"\n",(0,a.jsxs)(r.h3,{id:"-cursorrowcount-ha-pasado-algo",children:["\ud83d\udfe8 ",(0,a.jsx)(r.code,{children:"cursor.rowcount"}),": \xbfHa pasado algo?"]}),"\n",(0,a.jsxs)(r.p,{children:["A veces ejecutas un ",(0,a.jsx)(r.code,{children:"UPDATE"})," pero no se actualiza nada (porque el ID no exist\xeda, por ejemplo). ",(0,a.jsx)(r.code,{children:"rowcount"})," te dice cu\xe1ntas filas se han visto afectadas."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'cursor.execute("DELETE FROM libros WHERE autor = ?", ("Desconocido",))\nprint(f"Se han eliminado {cursor.rowcount} libros.")\n'})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"-reglas-de-oro-del-crud",children:(0,a.jsx)(r.strong,{children:"\u2705 Reglas de Oro del CRUD"})}),"\n",(0,a.jsx)(r.admonition,{title:"resumen profesional",type:"tip",children:(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsxs)(r.strong,{children:["Siempre con ",(0,a.jsx)(r.code,{children:"WHERE"})]}),": En Updates y Deletes, aseg\xfarate de que tu filtro es correcto antes de ejecutar."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Commit es obligatorio"}),": Si no haces ",(0,a.jsx)(r.code,{children:"commit()"})," (manualmente o mediante un ",(0,a.jsx)(r.code,{children:"with"}),"), tus INSERTS, UPDATES y DELETES desaparecer\xe1n al cerrar la conexi\xf3n."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Par\xe1metros siempre"}),": Los ",(0,a.jsx)(r.code,{children:"?"})," no son opcionales en c\xf3digo profesional. Nunca metas variables directamente en el string del SQL."]}),"\n"]})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsxs)(r.h2,{id:"-ejercicios-pr\xe1cticos--misi\xf3n-la-cripta-de-datos-parte-2",children:[(0,a.jsx)(r.strong,{children:"\ud83e\uddea Ejercicios pr\xe1cticos"})," \u2013 Misi\xf3n: La Cripta de Datos (Parte 2)"]}),"\n",(0,a.jsx)(r.p,{children:"La biblioteca secreta ya tiene su base de datos. Ahora el bibliotecario necesita que empieces a gestionar los tomos antiguos."}),"\n",(0,a.jsx)(r.h3,{id:"-fase-1--el-gran-ingreso",children:"\ud83d\udfe2 Fase 1 \u2013 El Gran Ingreso"}),"\n",(0,a.jsx)(r.h4,{id:"-ejercicio-1--el-primer-manuscrito",children:"\ud83d\udfe9 Ejercicio 1 \u2013 El Primer Manuscrito"}),"\n",(0,a.jsxs)(r.p,{children:['Inserta un libro titulado "Necronomic\xf3n", de "Abdul Alhazred", con 666 p\xe1ginas. Aseg\xfarate de hacer ',(0,a.jsx)(r.code,{children:"commit()"}),"."]}),"\n",(0,a.jsx)(r.h4,{id:"-ejercicio-2--la-caravana-de-libros",children:"\ud83d\udfe6 Ejercicio 2 \u2013 La Caravana de Libros"}),"\n",(0,a.jsx)(r.p,{children:"Tienes una lista de libros que acaba de llegar:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:'lote = [\n    ("Fundaci\xf3n", "Isaac Asimov", 255),\n    ("El Hobbit", "J.R.R. Tolkien", 310),\n    ("Neuromante", "William Gibson", 271)\n]\n'})}),"\n",(0,a.jsx)(r.p,{children:"Ins\xe9rtalos todos de una sola vez usando la funci\xf3n m\xe1s eficiente."}),"\n",(0,a.jsx)(r.h4,{id:"-ejercicio-3--importaci\xf3n-masiva-csv",children:"\ud83d\udfe8 Ejercicio 3 \u2013 Importaci\xf3n Masiva (CSV)"}),"\n",(0,a.jsxs)(r.p,{children:["En la carpeta de recursos tienes el archivo ",(0,a.jsx)(r.code,{children:"biblioteca_inicial.csv"}),". Crea un script que lea este archivo y vuelque todos sus libros en la base de datos ",(0,a.jsx)(r.code,{children:"biblioteca_secreta.db"}),".\n",(0,a.jsxs)(r.em,{children:["(Pista: necesitar\xe1s combinar el m\xf3dulo ",(0,a.jsx)(r.code,{children:"csv"})," que aprendimos en el bloque anterior con ",(0,a.jsx)(r.code,{children:"executemany"}),")"]})]}),"\n",(0,a.jsx)(r.h3,{id:"-fase-2--auditor\xeda-de-estanter\xedas",children:"\ud83d\udfe1 Fase 2 \u2013 Auditor\xeda de Estanter\xedas"}),"\n",(0,a.jsx)(r.h4,{id:"-ejercicio-4--el-buscador",children:"\ud83d\udfe7 Ejercicio 4 \u2013 El Buscador"}),"\n",(0,a.jsx)(r.p,{children:"Pide al usuario un nombre de autor por teclado. Busca en la base de datos todos los libros de ese autor y mu\xe9stralos por pantalla. Si no hay ninguno, avisa al usuario."}),"\n",(0,a.jsx)(r.h4,{id:"-ejercicio-5--espacio-en-las-estanter\xedas",children:"\ud83d\udfeb Ejercicio 5 \u2013 Espacio en las estanter\xedas"}),"\n",(0,a.jsxs)(r.p,{children:['El bibliotecario decide que los libros de menos de 100 p\xe1ginas no son "tomos reales" y deben ser eliminados de la base de datos de la biblioteca secreta. Realiza el borrado y muestra por pantalla cu\xe1ntos registros se han eliminado usando ',(0,a.jsx)(r.code,{children:"rowcount"}),"."]}),"\n",(0,a.jsx)(r.h3,{id:"-fase-3--mantenimiento-preventivo",children:"\ud83d\udd34 Fase 3 \u2013 Mantenimiento Preventivo"}),"\n",(0,a.jsx)(r.h4,{id:"-ejercicio-5--restauraci\xf3n-de-tomos",children:"\ud83d\udfe5 Ejercicio 5 \u2013 Restauraci\xf3n de Tomos"}),"\n",(0,a.jsx)(r.p,{children:"Se ha descubierto que todos los libros de \"Isaac Asimov\" deben marcarse con el estado 'en restauraci\xf3n'. Actualiza sus registros y verifica que el cambio se ha realizado correctamente consultando de nuevo la base de datos."}),"\n",(0,a.jsx)(r.h4,{id:"-ejercicio-6--el-informe-de-la-cripta",children:"\ud83d\udfea Ejercicio 6 \u2013 El Informe de la Cripta"}),"\n",(0,a.jsx)(r.p,{children:"Genera un informe por consola que muestre:"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsx)(r.li,{children:"El t\xedtulo del libro m\xe1s largo de la biblioteca."}),"\n",(0,a.jsxs)(r.li,{children:["El n\xfamero total de libros registrados actualmente.\n",(0,a.jsxs)(r.em,{children:["(Pista: puedes usar funciones SQL como ",(0,a.jsx)(r.code,{children:"MAX()"})," y ",(0,a.jsx)(r.code,{children:"COUNT()"})," o procesar los datos con Python tras un ",(0,a.jsx)(r.code,{children:"SELECT *"}),")"]})]}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>c});var n=s(6540);const a={},o=n.createContext(a);function i(e){const r=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(o.Provider,{value:r},e.children)}}}]);