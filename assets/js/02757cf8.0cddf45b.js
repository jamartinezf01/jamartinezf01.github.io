"use strict";(self.webpackChunkp_my_dm=self.webpackChunkp_my_dm||[]).push([[7717],{7199:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"python/UT7 - Persistencia/7.3 BBDD/7.3.3_consultas_sqlite","title":"7.3.3 Consultas Avanzadas y Agregaci\xf3n","description":"En el mundo real, los datos no son \xfatiles si no podemos extraer conclusiones de ellos. No basta con saber qu\xe9 libros hay; necesitamos saber cu\xe1ntos son de cierto autor, cu\xe1l es el m\xe1s caro o filtrar aquellos que empiezan por una letra espec\xedfica.","source":"@site/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.3_consultas_sqlite.md","sourceDirName":"python/UT7 - Persistencia/7.3 BBDD","slug":"/python/UT7 - Persistencia/7.3 BBDD/7.3.3_consultas_sqlite","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.3_consultas_sqlite","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"pythonSidebar","previous":{"title":"7.3.2 CRUD con SQLite","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.2_crud_sqlite"},"next":{"title":"7.3.4 Relaciones e Integridad de Datos","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.4_relaciones_integridad"}}');var a=n(4848),o=n(8453);const r={sidebar_position:4},l="7.3.3 Consultas Avanzadas y Agregaci\xf3n",c={},d=[{value:"<strong>1\ufe0f\u20e3 El Arte de Filtrar: M\xe1s all\xe1 del <code>=</code></strong>",id:"1\ufe0f\u20e3-el-arte-de-filtrar-m\xe1s-all\xe1-del-",level:2},{value:"\ud83d\udfe9 Patrones con <code>LIKE</code>",id:"-patrones-con-like",level:3},{value:"\ud83d\udfe6 Rangos y Listas (<code>BETWEEN</code>, <code>IN</code>, <code>DISTINCT</code>)",id:"-rangos-y-listas-between-in-distinct",level:3},{value:"<strong>2\ufe0f\u20e3 Funciones de Agregado y Agrupaci\xf3n</strong>",id:"2\ufe0f\u20e3-funciones-de-agregado-y-agrupaci\xf3n",level:2},{value:"\ud83d\udfe9 Las 5 Funciones Maestras",id:"-las-5-funciones-maestras",level:3},{value:"\ud83d\udfe6 <code>GROUP BY</code> y <code>HAVING</code>",id:"-group-by-y-having",level:3},{value:"<strong>3\ufe0f\u20e3 Orden, L\xedmite y Paginaci\xf3n</strong>",id:"3\ufe0f\u20e3-orden-l\xedmite-y-paginaci\xf3n",level:2},{value:"\ud83d\udfe9 <code>ORDER BY</code> (Ordenaci\xf3n)",id:"-order-by-ordenaci\xf3n",level:3},{value:"\ud83d\udfe6 <code>LIMIT</code> y <code>OFFSET</code> (Paginaci\xf3n)",id:"-limit-y-offset-paginaci\xf3n",level:3},{value:"<strong>4\ufe0f\u20e3 Alias y Subconsultas</strong>",id:"4\ufe0f\u20e3-alias-y-subconsultas",level:2},{value:"\ud83d\udfe9 Alias (<code>AS</code>)",id:"-alias-as",level:3},{value:"\ud83d\udfe6 Subconsultas",id:"-subconsultas",level:3},{value:"<strong>\u2705 Buenas pr\xe1cticas en Consultas</strong>",id:"-buenas-pr\xe1cticas-en-consultas",level:2},{value:"<strong>\ud83e\uddea Ejercicios pr\xe1cticos</strong> \u2013 Misi\xf3n: La Cripta de Datos (Parte 3)",id:"-ejercicios-pr\xe1cticos--misi\xf3n-la-cripta-de-datos-parte-3",level:2},{value:"\ud83d\udfe2 Fase 1 \u2013 B\xfasqueda de Patrones",id:"-fase-1--b\xfasqueda-de-patrones",level:3},{value:"\ud83d\udfe9 Ejercicio 1 \u2013 Los Manuscritos Perdidos",id:"-ejercicio-1--los-manuscritos-perdidos",level:4},{value:"\ud83d\udfe6 Ejercicio 2 \u2013 La Zona de Estudio",id:"-ejercicio-2--la-zona-de-estudio",level:4},{value:"\ud83d\udfe1 Fase 2 \u2013 El Resumen del Sabio",id:"-fase-2--el-resumen-del-sabio",level:3},{value:"\ud83d\udfe8 Ejercicio 3 \u2013 Estad\xedstica de Autores",id:"-ejercicio-3--estad\xedstica-de-autores",level:4},{value:"\ud83d\udfe7 Ejercicio 4 \u2013 Rankings de Autor\xeda",id:"-ejercicio-4--rankings-de-autor\xeda",level:4},{value:"\ud83d\udd34 Fase 3 \u2013 Consultas de \xc9lite",id:"-fase-3--consultas-de-\xe9lite",level:3},{value:"\ud83d\udfe5 Ejercicio 5 \u2013 El Libro que destaca",id:"-ejercicio-5--el-libro-que-destaca",level:4},{value:"\ud83d\udfea Ejercicio 6 \u2013 Paginaci\xf3n Real",id:"-ejercicio-6--paginaci\xf3n-real",level:4}];function t(e){const s={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"733-consultas-avanzadas-y-agregaci\xf3n",children:"7.3.3 Consultas Avanzadas y Agregaci\xf3n"})}),"\n",(0,a.jsx)(s.p,{children:"En el mundo real, los datos no son \xfatiles si no podemos extraer conclusiones de ellos. No basta con saber qu\xe9 libros hay; necesitamos saber cu\xe1ntos son de cierto autor, cu\xe1l es el m\xe1s caro o filtrar aquellos que empiezan por una letra espec\xedfica."}),"\n",(0,a.jsxs)(s.p,{children:['Aqu\xed es donde el SQL brilla como un lenguaje de "declaraci\xf3n de intenciones": t\xfa le dices ',(0,a.jsx)(s.strong,{children:"qu\xe9"})," quieres, no ",(0,a.jsx)(s.strong,{children:"c\xf3mo"})," encontrarlo."]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"1\ufe0f\u20e3-el-arte-de-filtrar-m\xe1s-all\xe1-del-",children:(0,a.jsxs)(s.strong,{children:["1\ufe0f\u20e3 El Arte de Filtrar: M\xe1s all\xe1 del ",(0,a.jsx)(s.code,{children:"="})]})}),"\n",(0,a.jsx)(s.p,{children:"Cuando buscamos datos, a veces no conocemos el valor exacto o buscamos un rango."}),"\n",(0,a.jsxs)(s.h3,{id:"-patrones-con-like",children:["\ud83d\udfe9 Patrones con ",(0,a.jsx)(s.code,{children:"LIKE"})]}),"\n",(0,a.jsx)(s.p,{children:"Permite buscar dentro de cadenas de texto usando comodines:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"%"})," \u27a1\ufe0f Sustituye a cualquier n\xfamero de caracteres (incluso ninguno)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"_"})," \u27a1\ufe0f Sustituye a exactamente un car\xe1cter."]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"-- Libros que empiezan por 'El'\nSELECT * FROM libros WHERE titulo LIKE 'El%';\n\n-- Libros que tienen 'an' en cualquier posici\xf3n\nSELECT * FROM libros WHERE autor LIKE '%an%';\n"})}),"\n",(0,a.jsxs)(s.h3,{id:"-rangos-y-listas-between-in-distinct",children:["\ud83d\udfe6 Rangos y Listas (",(0,a.jsx)(s.code,{children:"BETWEEN"}),", ",(0,a.jsx)(s.code,{children:"IN"}),", ",(0,a.jsx)(s.code,{children:"DISTINCT"}),")"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.code,{children:"BETWEEN"})}),": Filtra dentro de un rango inclusivo."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.code,{children:"IN"})}),": Verifica si el valor est\xe1 en una lista espec\xedfica."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.code,{children:"DISTINCT"})}),": Elimina duplicados del resultado."]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"-- Libros de entre 200 y 500 p\xe1ginas\nSELECT * FROM libros WHERE paginas BETWEEN 200 AND 500;\n\n-- Libros de autores espec\xedficos\nSELECT * FROM libros WHERE autor IN ('Isaac Asimov', 'George Orwell');\n\n-- Listado de todos los autores (sin repetir)\nSELECT DISTINCT autor FROM libros;\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"2\ufe0f\u20e3-funciones-de-agregado-y-agrupaci\xf3n",children:(0,a.jsx)(s.strong,{children:"2\ufe0f\u20e3 Funciones de Agregado y Agrupaci\xf3n"})}),"\n",(0,a.jsx)(s.p,{children:"Las funciones de agregado procesan un conjunto de filas para devolver un \xfanico valor de resumen."}),"\n",(0,a.jsx)(s.h3,{id:"-las-5-funciones-maestras",children:"\ud83d\udfe9 Las 5 Funciones Maestras"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"COUNT()"}),": Cuenta registros."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"SUM()"}),": Suma valores num\xe9ricos."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"AVG()"}),": Calcula el promedio."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"MAX()"})," / ",(0,a.jsx)(s.code,{children:"MIN()"}),": Encuentra el valor m\xe1ximo o m\xednimo."]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"SELECT COUNT(*) AS total_libros, AVG(paginas) AS promedio_paginas FROM libros;\n"})}),"\n",(0,a.jsxs)(s.h3,{id:"-group-by-y-having",children:["\ud83d\udfe6 ",(0,a.jsx)(s.code,{children:"GROUP BY"})," y ",(0,a.jsx)(s.code,{children:"HAVING"})]}),"\n",(0,a.jsxs)(s.p,{children:["Si queremos el resumen ",(0,a.jsx)(s.strong,{children:"por cada"})," autor, usamos ",(0,a.jsx)(s.code,{children:"GROUP BY"}),". Si queremos filtrar esos grupos, usamos ",(0,a.jsx)(s.code,{children:"HAVING"})," (el ",(0,a.jsx)(s.code,{children:"WHERE"})," de los grupos)."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"-- Contar libros por cada autor\nSELECT autor, COUNT(*) AS cantidad \nFROM libros \nGROUP BY autor;\n\n-- Solo autores que tengan m\xe1s de 5 libros registrados\nSELECT autor, COUNT(*) AS cantidad \nFROM libros \nGROUP BY autor \nHAVING cantidad > 5;\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"3\ufe0f\u20e3-orden-l\xedmite-y-paginaci\xf3n",children:(0,a.jsx)(s.strong,{children:"3\ufe0f\u20e3 Orden, L\xedmite y Paginaci\xf3n"})}),"\n",(0,a.jsx)(s.p,{children:"Controlar c\xf3mo y cu\xe1ntos datos recibimos es vital para el rendimiento y la experiencia de usuario."}),"\n",(0,a.jsxs)(s.h3,{id:"-order-by-ordenaci\xf3n",children:["\ud83d\udfe9 ",(0,a.jsx)(s.code,{children:"ORDER BY"})," (Ordenaci\xf3n)"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"-- Libros ordenados por p\xe1ginas de mayor a menor\nSELECT * FROM libros ORDER BY paginas DESC;\n"})}),"\n",(0,a.jsxs)(s.h3,{id:"-limit-y-offset-paginaci\xf3n",children:["\ud83d\udfe6 ",(0,a.jsx)(s.code,{children:"LIMIT"})," y ",(0,a.jsx)(s.code,{children:"OFFSET"})," (Paginaci\xf3n)"]}),"\n",(0,a.jsx)(s.p,{children:'Esto es lo que usan las webs para mostrar resultados "p\xe1gina 1, p\xe1gina 2...".'}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"LIMIT 10"}),": Trae solo los 10 primeros."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"OFFSET 10"}),": Salta los 10 primeros."]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:'# Traer la segunda p\xe1gina de resultados (resultados del 11 al 20)\ncursor.execute("SELECT * FROM libros LIMIT 10 OFFSET 10")\n'})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"4\ufe0f\u20e3-alias-y-subconsultas",children:(0,a.jsx)(s.strong,{children:"4\ufe0f\u20e3 Alias y Subconsultas"})}),"\n",(0,a.jsx)(s.p,{children:"A veces necesitamos usar el resultado de una consulta dentro de otra."}),"\n",(0,a.jsxs)(s.h3,{id:"-alias-as",children:["\ud83d\udfe9 Alias (",(0,a.jsx)(s.code,{children:"AS"}),")"]}),"\n",(0,a.jsx)(s.p,{children:"Sirve para dar nombres temporales y legibles a columnas calculadas o tablas."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"SELECT titulo, (paginas / 10) AS tiempo_estimado_lectura FROM libros;\n"})}),"\n",(0,a.jsx)(s.h3,{id:"-subconsultas",children:"\ud83d\udfe6 Subconsultas"}),"\n",(0,a.jsxs)(s.p,{children:["\xbfY si quieres buscar los libros que tienen m\xe1s p\xe1ginas que la media? No puedes poner ",(0,a.jsx)(s.code,{children:"AVG()"})," en un ",(0,a.jsx)(s.code,{children:"WHERE"})," directamente. Necesitas una subconsulta:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:"SELECT titulo, paginas \nFROM libros \nWHERE paginas > (SELECT AVG(paginas) FROM libros);\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"-buenas-pr\xe1cticas-en-consultas",children:(0,a.jsx)(s.strong,{children:"\u2705 Buenas pr\xe1cticas en Consultas"})}),"\n",(0,a.jsx)(s.admonition,{title:"resumen profesional",type:"tip",children:(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.strong,{children:["Evita el ",(0,a.jsx)(s.code,{children:"SELECT *"})]}),": En aplicaciones grandes, pide solo las columnas que vas a usar. Ahorra ancho de banda y memoria."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Alias claros"}),": Usa ",(0,a.jsx)(s.code,{children:"AS"})," para que tus resultados tengan nombres que se entiendan al leer el c\xf3digo Python."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.strong,{children:["Usa ",(0,a.jsx)(s.code,{children:"LIMIT"})]}),": Si vas a mostrar datos en una UI, nunca traigas 10,000 filas de golpe."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.strong,{children:["Cuidado con ",(0,a.jsx)(s.code,{children:"LIKE"})]}),": Las b\xfasquedas que empiezan por ",(0,a.jsx)(s.code,{children:"%"})," (ej: ",(0,a.jsx)(s.code,{children:"%texto"}),") son lentas porque SQLite no puede usar \xedndices para encontrarlas."]}),"\n"]})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"-ejercicios-pr\xe1cticos--misi\xf3n-la-cripta-de-datos-parte-3",children:[(0,a.jsx)(s.strong,{children:"\ud83e\uddea Ejercicios pr\xe1cticos"})," \u2013 Misi\xf3n: La Cripta de Datos (Parte 3)"]}),"\n",(0,a.jsx)(s.p,{children:'El archivo hist\xf3rico de la Cripta de Datos est\xe1 creciendo. El bibliotecario jefe te pide realizar un an\xe1lisis estad\xedstico para entender "el peso del conocimiento".'}),"\n",(0,a.jsx)(s.h3,{id:"-fase-1--b\xfasqueda-de-patrones",children:"\ud83d\udfe2 Fase 1 \u2013 B\xfasqueda de Patrones"}),"\n",(0,a.jsx)(s.h4,{id:"-ejercicio-1--los-manuscritos-perdidos",children:"\ud83d\udfe9 Ejercicio 1 \u2013 Los Manuscritos Perdidos"}),"\n",(0,a.jsxs)(s.p,{children:['Busca todos los libros cuyo t\xedtulo contenga la palabra "El" o "La" (puedes usar varios ',(0,a.jsx)(s.code,{children:"LIKE"})," u operadores ",(0,a.jsx)(s.code,{children:"OR"}),"). Muestra el resultado ordenado alfab\xe9ticamente por t\xedtulo."]}),"\n",(0,a.jsx)(s.h4,{id:"-ejercicio-2--la-zona-de-estudio",children:"\ud83d\udfe6 Ejercicio 2 \u2013 La Zona de Estudio"}),"\n",(0,a.jsxs)(s.p,{children:["Muestra \xfanicamente el t\xedtulo y el autor de los libros que tengan entre 300 y 600 p\xe1ginas, pero salta el primer resultado encontrado (usa ",(0,a.jsx)(s.code,{children:"OFFSET"}),")."]}),"\n",(0,a.jsx)(s.h3,{id:"-fase-2--el-resumen-del-sabio",children:"\ud83d\udfe1 Fase 2 \u2013 El Resumen del Sabio"}),"\n",(0,a.jsx)(s.h4,{id:"-ejercicio-3--estad\xedstica-de-autores",children:"\ud83d\udfe8 Ejercicio 3 \u2013 Estad\xedstica de Autores"}),"\n",(0,a.jsx)(s.p,{children:"Calcula y muestra por pantalla:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"El n\xfamero total de autores distintos que hay en la cripta."}),"\n",(0,a.jsx)(s.li,{children:"Cu\xe1ntos libros hay en total."}),"\n",(0,a.jsx)(s.li,{children:"El promedio de p\xe1ginas de todos los libros (redondeado a 2 decimales)."}),"\n"]}),"\n",(0,a.jsx)(s.h4,{id:"-ejercicio-4--rankings-de-autor\xeda",children:"\ud83d\udfe7 Ejercicio 4 \u2013 Rankings de Autor\xeda"}),"\n",(0,a.jsx)(s.p,{children:"Muestra una lista de autores junto con la cantidad de libros que tienen cada uno, ordenados de quien tiene m\xe1s libros a quien tiene menos. Solo deben aparecer autores que tengan m\xe1s de 1 libro."}),"\n",(0,a.jsx)(s.h3,{id:"-fase-3--consultas-de-\xe9lite",children:"\ud83d\udd34 Fase 3 \u2013 Consultas de \xc9lite"}),"\n",(0,a.jsx)(s.h4,{id:"-ejercicio-5--el-libro-que-destaca",children:"\ud83d\udfe5 Ejercicio 5 \u2013 El Libro que destaca"}),"\n",(0,a.jsxs)(s.p,{children:["Utilizando una ",(0,a.jsx)(s.strong,{children:"subconsulta"}),", encuentra y muestra el t\xedtulo del libro (o libros) que tienen un n\xfamero de p\xe1ginas superior al promedio de toda la biblioteca."]}),"\n",(0,a.jsx)(s.h4,{id:"-ejercicio-6--paginaci\xf3n-real",children:"\ud83d\udfea Ejercicio 6 \u2013 Paginaci\xf3n Real"}),"\n",(0,a.jsx)(s.p,{children:"Simula un sistema de p\xe1ginas para la consola:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Pregunta al usuario qu\xe9 p\xe1gina quiere ver (ej: P\xe1gina 1)."}),"\n",(0,a.jsx)(s.li,{children:"Muestra los libros de 3 en 3 (P\xe1gina 1: 1-3, P\xe1gina 2: 4-6...)."}),"\n",(0,a.jsxs)(s.li,{children:["Implementa la l\xf3gica usando ",(0,a.jsx)(s.code,{children:"LIMIT"})," y una f\xf3rmula matem\xe1tica para el ",(0,a.jsx)(s.code,{children:"OFFSET"})," basada en la p\xe1gina introducida por el usuario.\n",(0,a.jsx)(s.em,{children:"(F\xf3rmula: OFFSET = (pagina - 1) * limite)"})]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>l});var i=n(6540);const a={},o=i.createContext(a);function r(e){const s=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);