"use strict";(self.webpackChunkp_my_dm=self.webpackChunkp_my_dm||[]).push([[308],{263:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/soporte offline","title":"Soporte OffLine","description":"Una de las caracter\xedsticas m\xe1s \xfatiles de Firebase Realtime Database es la capacidad de funcionar sin conexi\xf3n (soporte offline). Esto significa que, aunque el dispositivo se quede sin acceso a Internet, la aplicaci\xf3n puede seguir leyendo y escribiendo datos en la base de datos. Una vez que se restablece la conexi\xf3n, se sincronizan autom\xe1ticamente los cambios con el servidor.","source":"@site/docs/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/soporte offline.md","sourceDirName":"aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database","slug":"/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/soporte offline","permalink":"/docs/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/soporte offline","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7}}');var i=s(4848),r=s(8453);const o={sidebar_position:7},c="Soporte OffLine",l={},t=[{value:"1. <strong>\xbfC\xf3mo habilitar el Soporte Offline?</strong>",id:"1-c\xf3mo-habilitar-el-soporte-offline",level:2},{value:"2. <strong>\xbfQu\xe9 sucede al habilitar la persistencia offline?</strong>",id:"2-qu\xe9-sucede-al-habilitar-la-persistencia-offline",level:2},{value:"3. <strong>Ejemplo de Uso con Lectura y Escritura</strong>",id:"3-ejemplo-de-uso-con-lectura-y-escritura",level:2},{value:"Escritura sin Conexi\xf3n",id:"escritura-sin-conexi\xf3n",level:3},{value:"Lectura sin Conexi\xf3n",id:"lectura-sin-conexi\xf3n",level:3},{value:"4. <strong>Manteniendo un Nodo Sincronizado con <code>keepSynced(true)</code></strong>",id:"4-manteniendo-un-nodo-sincronizado-con-keepsyncedtrue",level:2},{value:"5. <strong>Tama\xf1o de la Cach\xe9 y Consideraciones</strong>",id:"5-tama\xf1o-de-la-cach\xe9-y-consideraciones",level:2},{value:"6. <strong>Secuencia OffLine</strong>",id:"6-secuencia-offline",level:2},{value:"<strong>Buenas Pr\xe1cticas</strong>",id:"buenas-pr\xe1cticas",level:2}];function d(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"soporte-offline",children:"Soporte OffLine"})}),"\n",(0,i.jsxs)(n.p,{children:["Una de las caracter\xedsticas m\xe1s \xfatiles de ",(0,i.jsx)(n.strong,{children:"Firebase Realtime Database"})," es la capacidad de ",(0,i.jsx)(n.strong,{children:"funcionar sin conexi\xf3n"})," (soporte offline). Esto significa que, aunque el dispositivo se quede sin acceso a Internet, la aplicaci\xf3n puede ",(0,i.jsx)(n.strong,{children:"seguir leyendo y escribiendo datos"})," en la base de datos. Una vez que se restablece la conexi\xf3n, se sincronizan autom\xe1ticamente los cambios con el servidor."]}),"\n",(0,i.jsxs)(n.p,{children:["A continuaci\xf3n, veremos ",(0,i.jsx)(n.strong,{children:"c\xf3mo habilitar"})," esta funci\xf3n, ",(0,i.jsx)(n.strong,{children:"c\xf3mo se comporta"})," y ",(0,i.jsx)(n.strong,{children:"algunas buenas pr\xe1cticas"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"1-c\xf3mo-habilitar-el-soporte-offline",children:["1. ",(0,i.jsx)(n.strong,{children:"\xbfC\xf3mo habilitar el Soporte Offline?"})]}),"\n",(0,i.jsxs)(n.p,{children:["Por defecto, en las apps de Android, la persistencia offline ",(0,i.jsx)(n.strong,{children:"no"})," est\xe1 habilitada. Para activarla, se utiliza:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"FirebaseDatabase.getInstance().setPersistenceEnabled(true);\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsxs)(n.mdxAdmonitionTitle,{children:[(0,i.jsx)(n.strong,{children:"Importante"}),":"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Este comando debe ejecutarse ",(0,i.jsx)(n.strong,{children:"antes"})," de realizar cualquier otra referencia a la base de datos."]}),"\n",(0,i.jsxs)(n.li,{children:["Es recomendable hacerlo ",(0,i.jsx)(n.strong,{children:"una vez"})," en el ciclo de vida de la aplicaci\xf3n, por ejemplo, en la clase que extienda ",(0,i.jsx)(n.code,{children:"Application"})," o en la primera ",(0,i.jsx)(n.code,{children:"Activity"})," que se lance."]}),"\n"]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ejemplo"})," en una clase ",(0,i.jsx)(n.code,{children:"MyApp.java"})," que extiende ",(0,i.jsx)(n.code,{children:"Application"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class MyApp extends Application {\r\n    @Override\r\n    public void onCreate() {\r\n        super.onCreate();\r\n        // Habilitar la persistencia offline\r\n        FirebaseDatabase.getInstance().setPersistenceEnabled(true);\r\n    }\r\n}\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Luego, en tu ",(0,i.jsx)(n.code,{children:"AndroidManifest.xml"}),", debes indicar que ",(0,i.jsx)(n.code,{children:'android:name=".MyApp"'})," (o el paquete correspondiente) para que se ejecute antes que las actividades."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"2-qu\xe9-sucede-al-habilitar-la-persistencia-offline",children:["2. ",(0,i.jsx)(n.strong,{children:"\xbfQu\xe9 sucede al habilitar la persistencia offline?"})]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lectura de Datos en Cach\xe9"}),": Cuando tu aplicaci\xf3n solicita datos al servidor, Firebase guarda una copia en la ",(0,i.jsx)(n.strong,{children:"cach\xe9 local"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Acceso sin Conexi\xf3n"}),": Si el dispositivo pierde conexi\xf3n, tu app ",(0,i.jsx)(n.strong,{children:"seguir\xe1 accediendo"})," a esa cach\xe9 local como si fuera la base de datos real."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sincronizaci\xf3n Autom\xe1tica"}),": Cuando la conexi\xf3n se restablece, los cambios locales que se hicieron mientras el dispositivo estaba offline se ",(0,i.jsx)(n.strong,{children:"env\xedan"})," al servidor, y las actualizaciones del servidor se ",(0,i.jsx)(n.strong,{children:"descargan"})," al cliente."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["De esta forma, las operaciones ",(0,i.jsx)(n.strong,{children:"CRUD"})," que hagas mientras est\xe1s offline se encolan y se confirman cuando vuelves a tener Internet."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"3-ejemplo-de-uso-con-lectura-y-escritura",children:["3. ",(0,i.jsx)(n.strong,{children:"Ejemplo de Uso con Lectura y Escritura"})]}),"\n",(0,i.jsx)(n.h3,{id:"escritura-sin-conexi\xf3n",children:"Escritura sin Conexi\xf3n"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public void guardarMensaje(String texto) {\r\n    DatabaseReference mensajesRef = FirebaseDatabase.getInstance()\r\n        .getReference("mensajes");\r\n    \r\n    String key = mensajesRef.push().getKey();\r\n    if (key != null) {\r\n        Mensaje nuevoMensaje = new Mensaje(texto, System.currentTimeMillis());\r\n\r\n        // setValue() se almacenar\xe1 en cach\xe9 si no hay conexi\xf3n\r\n        mensajesRef.child(key).setValue(nuevoMensaje)\r\n            .addOnCompleteListener(task -> {\r\n                if (task.isSuccessful()) {\r\n                    Log.d("Offline", "Mensaje guardado (offline/online)");\r\n                } else {\r\n                    Log.e("Offline", "Error al guardar mensaje", task.getException());\r\n                }\r\n            });\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Si el dispositivo est\xe1 conectado, los datos se env\xedan de inmediato al servidor."}),"\n",(0,i.jsxs)(n.li,{children:["Si est\xe1 offline, la escritura se ",(0,i.jsx)(n.strong,{children:"pone en cola"})," y se sincroniza autom\xe1ticamente m\xe1s tarde."]}),"\n"]})}),"\n",(0,i.jsx)(n.h3,{id:"lectura-sin-conexi\xf3n",children:"Lectura sin Conexi\xf3n"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public void leerMensajes() {\r\n    DatabaseReference mensajesRef = FirebaseDatabase.getInstance()\r\n        .getReference("mensajes");\r\n\r\n    mensajesRef.addValueEventListener(new ValueEventListener() {\r\n        @Override\r\n        public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n            // Incluso si no hay conexi\xf3n, se lee la cach\xe9 local\r\n            List<Mensaje> lista = new ArrayList<>();\r\n            for (DataSnapshot ds : snapshot.getChildren()) {\r\n                Mensaje msg = ds.getValue(Mensaje.class);\r\n                if (msg != null) {\r\n                    lista.add(msg);\r\n                }\r\n            }\r\n            Log.d("Offline", "Mensajes obtenidos: " + lista.size());\r\n        }\r\n\r\n        @Override\r\n        public void onCancelled(@NonNull DatabaseError error) {\r\n            Log.e("Offline", "Error en la lectura de mensajes", error.toException());\r\n        }\r\n    });\r\n}\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Con soporte offline activado, si no hay conexi\xf3n, se retornar\xe1n los ",(0,i.jsx)(n.strong,{children:"datos de la cach\xe9"})," que se hayan le\xeddo previamente."]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"4-manteniendo-un-nodo-sincronizado-con-keepsyncedtrue",children:["4. ",(0,i.jsxs)(n.strong,{children:["Manteniendo un Nodo Sincronizado con ",(0,i.jsx)(n.code,{children:"keepSynced(true)"})]})]}),"\n",(0,i.jsxs)(n.p,{children:["En ocasiones, te interesa que ciertos nodos est\xe9n ",(0,i.jsx)(n.strong,{children:"siempre disponibles"})," offline, aunque no los hayas \u201cle\xeddo\u201d recientemente."]}),"\n",(0,i.jsxs)(n.p,{children:["Para ello, puedes indicar que un nodo se ",(0,i.jsx)(n.strong,{children:"sincronice de forma continua"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'DatabaseReference anunciosRef = FirebaseDatabase.getInstance().getReference("anuncios");\r\n// Forzar la sincronizaci\xf3n continua en segundo plano\r\nanunciosRef.keepSynced(true);\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Esto significa que, cada vez que est\xe9s online, la rama ",(0,i.jsx)(n.code,{children:"anuncios"})," se actualizar\xe1 y quedar\xe1 lista para consultas sin conexi\xf3n."]}),"\n"]})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Advertencia"}),": Consumir\xe1 m\xe1s datos y memoria, ya que se descargar\xe1 de manera proactiva."]}),"\n"]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"5-tama\xf1o-de-la-cach\xe9-y-consideraciones",children:["5. ",(0,i.jsx)(n.strong,{children:"Tama\xf1o de la Cach\xe9 y Consideraciones"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["La cach\xe9 local tiene un tama\xf1o ",(0,i.jsx)(n.strong,{children:"limitado"})," (por defecto, 10 MB). Si la app escribe o sincroniza una gran cantidad de datos, es posible que Firebase elimine los ",(0,i.jsx)(n.strong,{children:"datos menos recientes"})," para liberar espacio."]}),"\n",(0,i.jsxs)(n.li,{children:["No se trata de una base de datos local perpetua, sino de una ",(0,i.jsx)(n.strong,{children:"capa de sincronizaci\xf3n"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Si necesitas un almacenamiento offline permanente y muy estructurado, considera combinar Realtime Database con otras ",(0,i.jsx)(n.strong,{children:"bases de datos locales"})," (Room, SQLite, etc.) para ciertas funcionalidades."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"6-secuencia-offline",children:["6. ",(0,i.jsx)(n.strong,{children:"Secuencia OffLine"})]}),"\n",(0,i.jsx)("div",{style:{margin:"0 auto",width:"800px"},children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Diagrama de Secuencia",src:s(3379).A+"",title:"Diagrama de Secuencia",width:"1384",height:"1044"})})}),"\n",(0,i.jsx)(n.admonition,{title:"explicaci\xf3n",type:"note",children:(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["La app ",(0,i.jsx)(n.strong,{children:"habilita"})," la persistencia offline."]}),"\n",(0,i.jsxs)(n.li,{children:["Se realizan lecturas/escrituras en ",(0,i.jsx)(n.code,{children:"mDatabase"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Si hay conexi\xf3n, los datos se manejan normalmente."}),"\n",(0,i.jsxs)(n.li,{children:["Si ",(0,i.jsx)(n.strong,{children:"no"})," hay conexi\xf3n, se leen desde la ",(0,i.jsx)(n.strong,{children:"cach\xe9"})," y las escrituras quedan en ",(0,i.jsx)(n.strong,{children:"cola"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Al reconectarse, se ",(0,i.jsx)(n.strong,{children:"sincronizan"})," todos los cambios, quedando ",(0,i.jsx)(n.strong,{children:"consistentes"}),"."]}),"\n"]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"buenas-pr\xe1cticas",children:(0,i.jsx)(n.strong,{children:"Buenas Pr\xe1cticas"})}),"\n",(0,i.jsx)(n.admonition,{title:"SIGUE ESTAS PR\xc1CTICAS...",type:"tip",children:(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Habilitar persistencia en el punto inicial"})," (antes de usar cualquier referencia a la DB)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dise\xf1ar"})," la app para manejar correctamente situaciones offline \u2192 notificar al usuario que sigue trabajando sin conexi\xf3n."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Controlar tama\xf1o de datos"}),": La cach\xe9 es limitada. Maneja la estructura de la DB para no descargar grandes vol\xfamenes innecesarios."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"keepSynced"}),": \xdasalo con cuidado solo en los nodos que verdaderamente necesitas siempre disponibles."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test"}),": Probar en modo ",(0,i.jsx)(n.strong,{children:"avi\xf3n"})," o sin Wi-Fi/datos m\xf3viles para asegurarte de que tu app responde bien."]}),"\n"]})}),"\n",(0,i.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3379:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/secuenciaOffline-2e4017cd3126e925e75852c6c92f4f2f.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var a=s(6540);const i={},r=a.createContext(i);function o(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);