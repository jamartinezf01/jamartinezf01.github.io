"use strict";(self.webpackChunkp_my_dm=self.webpackChunkp_my_dm||[]).push([[4104],{6964:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/reglas de seguridad","title":"Reglas de Seguridad","description":"Firestore proporciona un sistema de reglas de seguridad basadas en expresiones para controlar el acceso a la base de datos. Estas reglas se configuran desde Firebase Console y determinan qu\xe9 usuarios pueden leer o escribir en la base de datos, asegurando la privacidad y la integridad de los datos.  trav\xe9s de este punto, aprenderemos a:","source":"@site/docs/salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/reglas de seguridad.md","sourceDirName":"salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore","slug":"/salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/reglas de seguridad","permalink":"/docs/salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Firestore/reglas de seguridad","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9}}');var a=r(4848),i=r(8453);const o={sidebar_position:9},d="Reglas de Seguridad",c={},l=[{value:"1. <strong>Configuraci\xf3n b\xe1sica de reglas en Firestore</strong>",id:"1-configuraci\xf3n-b\xe1sica-de-reglas-en-firestore",level:2},{value:"2. <strong>Reglas de acceso solo para usuarios autenticados (<code>request.auth</code>)</strong>",id:"2-reglas-de-acceso-solo-para-usuarios-autenticados-requestauth",level:2},{value:"3. <strong>Reglas de seguridad para colecciones espec\xedficas</strong>",id:"3-reglas-de-seguridad-para-colecciones-espec\xedficas",level:2},{value:"4. <strong>Permitir que cada usuario acceda solo a sus propios datos</strong>",id:"4-permitir-que-cada-usuario-acceda-solo-a-sus-propios-datos",level:2},{value:"5. <strong>Validaci\xf3n de datos antes de escribir en la base de datos</strong>",id:"5-validaci\xf3n-de-datos-antes-de-escribir-en-la-base-de-datos",level:2},{value:"6. <strong>Evitar modificaciones de campos espec\xedficos</strong>",id:"6-evitar-modificaciones-de-campos-espec\xedficos",level:2},{value:"7. <strong>Protecci\xf3n avanzada con condiciones en los datos (<code>resource</code>)</strong>",id:"7-protecci\xf3n-avanzada-con-condiciones-en-los-datos-resource",level:2},{value:"8. <strong>Auditor\xeda: Permitir solo creaci\xf3n de documentos, pero no edici\xf3n ni eliminaci\xf3n</strong>",id:"8-auditor\xeda-permitir-solo-creaci\xf3n-de-documentos-pero-no-edici\xf3n-ni-eliminaci\xf3n",level:2},{value:"9. <strong>C\xf3mo probar las reglas de seguridad</strong>",id:"9-c\xf3mo-probar-las-reglas-de-seguridad",level:2}];function t(e){const s={admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"reglas-de-seguridad",children:"Reglas de Seguridad"})}),"\n",(0,a.jsxs)(s.p,{children:["Firestore proporciona un sistema de ",(0,a.jsx)(s.strong,{children:"reglas de seguridad basadas en expresiones"})," para controlar el acceso a la base de datos. Estas reglas se configuran desde ",(0,a.jsx)(s.strong,{children:"Firebase Console"})," y determinan qu\xe9 usuarios pueden ",(0,a.jsx)(s.strong,{children:"leer o escribir"})," en la base de datos, asegurando la privacidad y la integridad de los datos.  trav\xe9s de este punto, aprenderemos a:"]}),"\n",(0,a.jsxs)(s.p,{children:["\u2705 ",(0,a.jsxs)(s.strong,{children:["Configurar reglas b\xe1sicas (",(0,a.jsx)(s.code,{children:"read"})," y ",(0,a.jsx)(s.code,{children:"write"}),")"]})," para permitir o restringir el acceso.",(0,a.jsx)(s.br,{}),"\n","\u2705 ",(0,a.jsxs)(s.strong,{children:["Usar autenticaci\xf3n (",(0,a.jsx)(s.code,{children:"request.auth"}),")"]})," para restringir el acceso solo a usuarios autenticados.",(0,a.jsx)(s.br,{}),"\n","\u2705 ",(0,a.jsx)(s.strong,{children:"Definir reglas avanzadas con condiciones"})," basadas en los datos del documento (",(0,a.jsx)(s.code,{children:"resource"}),").",(0,a.jsx)(s.br,{}),"\n","\u2705 ",(0,a.jsx)(s.strong,{children:"Proteger datos sensibles"})," para que solo el usuario due\xf1o del documento pueda acceder a su informaci\xf3n.",(0,a.jsx)(s.br,{}),"\n","\u2705 ",(0,a.jsx)(s.strong,{children:"Evitar accesos no autorizados"})," utilizando validaciones y restricciones."]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"1-configuraci\xf3n-b\xe1sica-de-reglas-en-firestore",children:["1. ",(0,a.jsx)(s.strong,{children:"Configuraci\xf3n b\xe1sica de reglas en Firestore"})]}),"\n",(0,a.jsxs)(s.p,{children:["Las reglas de seguridad se configuran en la ",(0,a.jsx)(s.strong,{children:"secci\xf3n Firestore Database \u2192 Rules"})," de Firebase Console."]}),"\n",(0,a.jsxs)(s.p,{children:["Por defecto, Firestore ",(0,a.jsx)(s.strong,{children:"no permite accesos p\xfablicos"})," y requiere configuraci\xf3n. Una regla b\xe1sica que permite acceso total a la base de datos es:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /{document=**} {\r\n      allow read, write: if true;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"warning",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Cuidado:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Esta regla permite ",(0,a.jsx)(s.strong,{children:"a cualquier usuario acceder y modificar datos"}),", lo que no es seguro para aplicaciones en producci\xf3n."]}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"2-reglas-de-acceso-solo-para-usuarios-autenticados-requestauth",children:["2. ",(0,a.jsxs)(s.strong,{children:["Reglas de acceso solo para usuarios autenticados (",(0,a.jsx)(s.code,{children:"request.auth"}),")"]})]}),"\n",(0,a.jsxs)(s.p,{children:["Para permitir que ",(0,a.jsx)(s.strong,{children:"solo usuarios autenticados"})," puedan leer y escribir datos:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /{document=**} {\r\n      allow read, write: if request.auth != null;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Explicaci\xf3n:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"request.auth != null"})," verifica si el usuario est\xe1 autenticado con Firebase Authentication."]}),"\n",(0,a.jsx)(s.li,{children:"Solo los usuarios registrados podr\xe1n acceder a la base de datos."}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"3-reglas-de-seguridad-para-colecciones-espec\xedficas",children:["3. ",(0,a.jsx)(s.strong,{children:"Reglas de seguridad para colecciones espec\xedficas"})]}),"\n",(0,a.jsxs)(s.p,{children:["Podemos definir reglas para restringir accesos a ",(0,a.jsx)(s.strong,{children:"colecciones o documentos espec\xedficos"}),".",(0,a.jsx)(s.br,{}),"\n","Ejemplo: Permitir solo lectura en la colecci\xf3n ",(0,a.jsx)(s.strong,{children:'"peliculas"'}),", pero sin escritura:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /peliculas/{peliculaId} {\r\n      allow read: if true;\r\n      allow write: if false;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Explicaci\xf3n:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"allow read: if true;"}),' \u2192 Cualquier usuario puede leer los documentos de "peliculas".']}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"allow write: if false;"})," \u2192 Nadie puede escribir en la colecci\xf3n."]}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"4-permitir-que-cada-usuario-acceda-solo-a-sus-propios-datos",children:["4. ",(0,a.jsx)(s.strong,{children:"Permitir que cada usuario acceda solo a sus propios datos"})]}),"\n",(0,a.jsxs)(s.p,{children:["Si cada usuario tiene un documento con su informaci\xf3n dentro de la colecci\xf3n ",(0,a.jsx)(s.strong,{children:"usuarios"}),", podemos restringir el acceso solo al due\xf1o del documento."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /usuarios/{userId} {\r\n      allow read, write: if request.auth != null && request.auth.uid == userId;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Explicaci\xf3n:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"request.auth.uid == userId"})," permite acceso ",(0,a.jsx)(s.strong,{children:"solo si el usuario autenticado es el due\xf1o del documento"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:['Se asume que los documentos de "usuarios" tienen como ID el mismo ',(0,a.jsx)(s.code,{children:"uid"})," del usuario en Firebase Authentication."]}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"5-validaci\xf3n-de-datos-antes-de-escribir-en-la-base-de-datos",children:["5. ",(0,a.jsx)(s.strong,{children:"Validaci\xf3n de datos antes de escribir en la base de datos"})]}),"\n",(0,a.jsxs)(s.p,{children:["Podemos definir reglas para asegurarnos de que los datos ingresados sean v\xe1lidos.",(0,a.jsx)(s.br,{}),"\n","Ejemplo: Restringir la creaci\xf3n de pel\xedculas donde el a\xf1o de estreno no sea mayor a 1900."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /peliculas/{peliculaId} {\r\n      allow write: if request.auth != null && request.resource.data.a\xf1o > 1900;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Explicaci\xf3n:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"request.resource.data.a\xf1o > 1900"})," evita que se registren pel\xedculas con a\xf1os inv\xe1lidos."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"request.auth != null"})," asegura que solo usuarios autenticados puedan escribir datos."]}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"6-evitar-modificaciones-de-campos-espec\xedficos",children:["6. ",(0,a.jsx)(s.strong,{children:"Evitar modificaciones de campos espec\xedficos"})]}),"\n",(0,a.jsxs)(s.p,{children:["Podemos permitir que los usuarios editen solo ciertos campos de un documento.",(0,a.jsx)(s.br,{}),"\n","Ejemplo: Permitir que los usuarios actualicen solo la ",(0,a.jsx)(s.strong,{children:'"rese\xf1a"'}),", pero no el ",(0,a.jsx)(s.strong,{children:'"titulo"'})," de una pel\xedcula."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /rese\xf1as/{resenaId} {\r\n      allow update: if request.resource.data.keys().hasOnly([\"rese\xf1a\"]);\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Explicaci\xf3n:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:'request.resource.data.keys().hasOnly(["rese\xf1a"])'})," verifica que el usuario ",(0,a.jsx)(s.strong,{children:'solo intente modificar el campo "rese\xf1a"'}),"."]}),"\n",(0,a.jsx)(s.li,{children:"Si intenta cambiar otro campo, la operaci\xf3n ser\xe1 rechazada."}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"7-protecci\xf3n-avanzada-con-condiciones-en-los-datos-resource",children:["7. ",(0,a.jsxs)(s.strong,{children:["Protecci\xf3n avanzada con condiciones en los datos (",(0,a.jsx)(s.code,{children:"resource"}),")"]})]}),"\n",(0,a.jsxs)(s.p,{children:["Podemos aplicar reglas m\xe1s complejas que verifiquen los valores de los documentos antes de conceder acceso.",(0,a.jsx)(s.br,{}),"\n","Ejemplo: Permitir escribir una pel\xedcula solo si ",(0,a.jsx)(s.strong,{children:"no supera los 300 minutos de duraci\xf3n"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /peliculas/{peliculaId} {\r\n      allow write: if request.auth != null && request.resource.data.duracion <= 300;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Explicaci\xf3n:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"request.resource.data.duracion <= 300"})," asegura que las pel\xedculas no tengan una duraci\xf3n superior a ",(0,a.jsx)(s.strong,{children:"300 minutos"}),"."]}),"\n",(0,a.jsx)(s.li,{children:"Esto previene datos inv\xe1lidos y mantiene la coherencia en la base de datos."}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"8-auditor\xeda-permitir-solo-creaci\xf3n-de-documentos-pero-no-edici\xf3n-ni-eliminaci\xf3n",children:["8. ",(0,a.jsx)(s.strong,{children:"Auditor\xeda: Permitir solo creaci\xf3n de documentos, pero no edici\xf3n ni eliminaci\xf3n"})]}),"\n",(0,a.jsxs)(s.p,{children:["Si queremos que los usuarios puedan ",(0,a.jsx)(s.strong,{children:"crear documentos pero no editarlos ni eliminarlos"}),", usamos ",(0,a.jsx)(s.code,{children:"allow create:"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    match /comentarios/{comentarioId} {\r\n      allow create: if request.auth != null;\r\n      allow update, delete: if false;\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.mdxAdmonitionTitle,{children:(0,a.jsx)(s.strong,{children:"Explicaci\xf3n:"})}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"allow create: if request.auth != null;"})," \u2192 Solo permite crear documentos si el usuario est\xe1 autenticado."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"allow update, delete: if false;"})," \u2192 Impide que los usuarios modifiquen o eliminen documentos."]}),"\n"]})]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h2,{id:"9-c\xf3mo-probar-las-reglas-de-seguridad",children:["9. ",(0,a.jsx)(s.strong,{children:"C\xf3mo probar las reglas de seguridad"})]}),"\n",(0,a.jsxs)(s.p,{children:["Antes de implementar las reglas en producci\xf3n, podemos probarlas con el ",(0,a.jsx)(s.strong,{children:"simulador de reglas de Firebase"}),":"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Ir a ",(0,a.jsx)(s.strong,{children:"Firebase Console \u2192 Firestore Database \u2192 Rules"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:["Hacer clic en ",(0,a.jsx)(s.strong,{children:"Simular una consulta"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:["Seleccionar la ",(0,a.jsx)(s.strong,{children:"colecci\xf3n y documento"})," a probar."]}),"\n",(0,a.jsxs)(s.li,{children:["Elegir la operaci\xf3n (",(0,a.jsx)(s.code,{children:"read"}),", ",(0,a.jsx)(s.code,{children:"write"}),", etc.)."]}),"\n",(0,a.jsxs)(s.li,{children:["Ejecutar la prueba y verificar si la consulta es ",(0,a.jsx)(s.strong,{children:"aceptada o rechazada"}),"."]}),"\n"]}),"\n",(0,a.jsx)(s.hr,{})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>d});var n=r(6540);const a={},i=n.createContext(a);function o(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);