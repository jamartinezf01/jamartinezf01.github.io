"use strict";(self.webpackChunkp_my_dm=self.webpackChunkp_my_dm||[]).push([[7630],{5927:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"python/UT7 - Persistencia/7.3 BBDD/7.3.4_relaciones_integridad","title":"7.3.4 Relaciones e Integridad de Datos","description":"Una base de datos no es solo un almac\xe9n de tablas aisladas. Su verdadero poder reside en la capacidad de relacionar informaci\xf3n y asegurar que esos datos sean coherentes y fiables. Esto se conoce como Integridad Referencial.","source":"@site/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.4_relaciones_integridad.md","sourceDirName":"python/UT7 - Persistencia/7.3 BBDD","slug":"/python/UT7 - Persistencia/7.3 BBDD/7.3.4_relaciones_integridad","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.4_relaciones_integridad","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"pythonSidebar","previous":{"title":"7.3.3 Consultas Avanzadas y Agregaci\xf3n","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.3_consultas_sqlite"},"next":{"title":"7.3.5 Transacciones y Manejo de Errores","permalink":"/docs/python/UT7 - Persistencia/7.3 BBDD/7.3.5_transacciones_errores"}}');var s=r(4848),i=r(8453);const o={sidebar_position:5},c="7.3.4 Relaciones e Integridad de Datos",d={},l=[{value:"<strong>1\ufe0f\u20e3 Relaciones entre Tablas: Claves y Conexiones</strong>",id:"1\ufe0f\u20e3-relaciones-entre-tablas-claves-y-conexiones",level:2},{value:"\ud83d\udfe9 Clave Primaria (Primary Key - PK)",id:"-clave-primaria-primary-key---pk",level:3},{value:"\ud83d\udfe6 Clave For\xe1nea (Foreign Key - FK)",id:"-clave-for\xe1nea-foreign-key---fk",level:3},{value:"<strong>2\ufe0f\u20e3 Restricciones de Integridad</strong>",id:"2\ufe0f\u20e3-restricciones-de-integridad",level:2},{value:"\ud83d\udfe9 <code>UNIQUE</code> y <code>NOT NULL</code>",id:"-unique-y-not-null",level:3},{value:"\ud83d\udfe6 <code>CHECK</code> y <code>DEFAULT</code>",id:"-check-y-default",level:3},{value:"<strong>3\ufe0f\u20e3 Acciones Referenciales: \xbfQu\xe9 pasa si borro al &quot;padre&quot;?</strong>",id:"3\ufe0f\u20e3-acciones-referenciales-qu\xe9-pasa-si-borro-al-padre",level:2},{value:"\ud83d\udfe9 <code>ON DELETE RESTRICT</code> (Por defecto)",id:"-on-delete-restrict-por-defecto",level:3},{value:"\ud83d\udfe6 <code>ON DELETE CASCADE</code>",id:"-on-delete-cascade",level:3},{value:"\ud83d\udfe8 <code>ON DELETE SET NULL</code>",id:"-on-delete-set-null",level:3},{value:"<strong>4\ufe0f\u20e3 Manejo de Errores con <code>IntegrityError</code></strong>",id:"4\ufe0f\u20e3-manejo-de-errores-con-integrityerror",level:2},{value:"<strong>\u2705 Buenas pr\xe1cticas en Dise\xf1o Relacional</strong>",id:"-buenas-pr\xe1cticas-en-dise\xf1o-relacional",level:2},{value:"<strong>\ud83e\uddea Ejercicios pr\xe1cticos</strong> \u2013 Misi\xf3n: La Cripta de Datos (Parte 4)",id:"-ejercicios-pr\xe1cticos--misi\xf3n-la-cripta-de-datos-parte-4",level:2},{value:"\ud83d\udfe2 Fase 1 \u2013 Reestructuraci\xf3n Masiva",id:"-fase-1--reestructuraci\xf3n-masiva",level:3},{value:"\ud83d\udfe9 Ejercicio 1 \u2013 El Archivo de Sabios",id:"-ejercicio-1--el-archivo-de-sabios",level:4},{value:"\ud83d\udfe6 Ejercicio 2 \u2013 Libros Conectados",id:"-ejercicio-2--libros-conectados",level:4},{value:"\ud83d\udfe1 Fase 2 \u2013 Blindaje de Datos",id:"-fase-2--blindaje-de-datos",level:3},{value:"\ud83d\udfe8 Ejercicio 3 \u2013 Reglas de la Orden",id:"-ejercicio-3--reglas-de-la-orden",level:4},{value:"\ud83d\udfe7 Ejercicio 4 \u2013 El Detector de Errores",id:"-ejercicio-4--el-detector-de-errores",level:4},{value:"\ud83d\udd34 Fase 3 \u2013 Gesti\xf3n de Despedidas",id:"-fase-3--gesti\xf3n-de-despedidas",level:3},{value:"\ud83d\udfe5 Ejercicio 5 \u2013 Borrado en Cascada",id:"-ejercicio-5--borrado-en-cascada",level:4},{value:"\ud83d\udfea Ejercicio 6 \u2013 La Gran Consulta (Preview)",id:"-ejercicio-6--la-gran-consulta-preview",level:4}];function t(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"734-relaciones-e-integridad-de-datos",children:"7.3.4 Relaciones e Integridad de Datos"})}),"\n",(0,s.jsxs)(n.p,{children:["Una base de datos no es solo un almac\xe9n de tablas aisladas. Su verdadero poder reside en la capacidad de ",(0,s.jsx)(n.strong,{children:"relacionar"})," informaci\xf3n y asegurar que esos datos sean coherentes y fiables. Esto se conoce como ",(0,s.jsx)(n.strong,{children:"Integridad Referencial"}),"."]}),"\n",(0,s.jsx)(n.p,{children:'En este punto, aprenderemos a conectar tablas y a poner "reglas de juego" para que la base de datos rechace autom\xe1ticamente informaci\xf3n incoherente.'}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1\ufe0f\u20e3-relaciones-entre-tablas-claves-y-conexiones",children:(0,s.jsx)(n.strong,{children:"1\ufe0f\u20e3 Relaciones entre Tablas: Claves y Conexiones"})}),"\n",(0,s.jsx)(n.p,{children:"Para conectar dos tablas, usamos dos conceptos fundamentales:"}),"\n",(0,s.jsx)(n.h3,{id:"-clave-primaria-primary-key---pk",children:"\ud83d\udfe9 Clave Primaria (Primary Key - PK)"}),"\n",(0,s.jsx)(n.p,{children:'Es el "DNI" de cada fila. Identifica de forma \xfanica e inequ\xedvoca a un registro.'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No puede repetirse."}),"\n",(0,s.jsx)(n.li,{children:"No puede ser nula."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-clave-for\xe1nea-foreign-key---fk",children:"\ud83d\udfe6 Clave For\xe1nea (Foreign Key - FK)"}),"\n",(0,s.jsx)(n.p,{children:'Es una columna en una tabla (hija) que apunta a la Clave Primaria de otra tabla (padre). Es el "enlace" que crea la relaci\xf3n.'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Tabla Padre: Autores\nCREATE TABLE autores (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    nombre TEXT NOT NULL UNIQUE\n);\n\n-- Tabla Hija: Libros (cada libro pertenece a un autor)\nCREATE TABLE libros (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    titulo TEXT NOT NULL,\n    autor_id INTEGER,\n    FOREIGN KEY (autor_id) REFERENCES autores(id)\n);\n"})}),"\n",(0,s.jsxs)(n.admonition,{title:"\xa1Importante en SQLite!",type:"warning",children:[(0,s.jsxs)(n.p,{children:["Por defecto, SQLite ",(0,s.jsx)(n.strong,{children:"no valida"})," las claves for\xe1neas por compatibilidad hist\xf3rica. Debes activarlas manualmente al conectar:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'conexion = sqlite3.connect("mi_base.db")\nconexion.execute("PRAGMA foreign_keys = ON") # Imprescindible\n'})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2\ufe0f\u20e3-restricciones-de-integridad",children:(0,s.jsx)(n.strong,{children:"2\ufe0f\u20e3 Restricciones de Integridad"})}),"\n",(0,s.jsx)(n.p,{children:'Las restricciones son reglas que definimos en las columnas para evitar que entren datos "sucios" o incorrectos.'}),"\n",(0,s.jsxs)(n.h3,{id:"-unique-y-not-null",children:["\ud83d\udfe9 ",(0,s.jsx)(n.code,{children:"UNIQUE"})," y ",(0,s.jsx)(n.code,{children:"NOT NULL"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"NOT NULL"})}),": Obliga a que el campo tenga un valor."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"UNIQUE"})}),": Impide que dos filas tengan el mismo valor en esa columna (ej: un email o un ISBN)."]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"-check-y-default",children:["\ud83d\udfe6 ",(0,s.jsx)(n.code,{children:"CHECK"})," y ",(0,s.jsx)(n.code,{children:"DEFAULT"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"CHECK (condici\xf3n)"})}),": Solo permite insertar datos que cumplan una regla l\xf3gica."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"DEFAULT valor"})}),": Si no se indica nada, pone un valor por defecto."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE usuarios (\n    id INTEGER PRIMARY KEY,\n    nombre TEXT NOT NULL,\n    email TEXT UNIQUE,\n    edad INTEGER CHECK(edad >= 18),\n    rol TEXT DEFAULT 'lector'\n);\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3\ufe0f\u20e3-acciones-referenciales-qu\xe9-pasa-si-borro-al-padre",children:(0,s.jsx)(n.strong,{children:'3\ufe0f\u20e3 Acciones Referenciales: \xbfQu\xe9 pasa si borro al "padre"?'})}),"\n",(0,s.jsx)(n.p,{children:'Cuando borras un registro que tiene "hijos" (datos que apuntan a \xe9l), \xbfqu\xe9 debe hacer la base de datos?'}),"\n",(0,s.jsxs)(n.h3,{id:"-on-delete-restrict-por-defecto",children:["\ud83d\udfe9 ",(0,s.jsx)(n.code,{children:"ON DELETE RESTRICT"})," (Por defecto)"]}),"\n",(0,s.jsx)(n.p,{children:"Impide borrar al padre si tiene hijos. Primero debes borrar los hijos o reasignarlos. Es la opci\xf3n m\xe1s segura."}),"\n",(0,s.jsxs)(n.h3,{id:"-on-delete-cascade",children:["\ud83d\udfe6 ",(0,s.jsx)(n.code,{children:"ON DELETE CASCADE"})]}),"\n",(0,s.jsxs)(n.p,{children:["Si borras al padre, ",(0,s.jsx)(n.strong,{children:"borra autom\xe1ticamente"}),' todos sus hijos. \xdatil para "limpiezas autom\xe1ticas" pero peligroso si no se tiene cuidado.']}),"\n",(0,s.jsxs)(n.h3,{id:"-on-delete-set-null",children:["\ud83d\udfe8 ",(0,s.jsx)(n.code,{children:"ON DELETE SET NULL"})]}),"\n",(0,s.jsxs)(n.p,{children:["Si borras al padre, los hijos se quedan, pero su referencia (FK) pasa a ser ",(0,s.jsx)(n.code,{children:"NULL"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE libros (\n    ...\n    FOREIGN KEY (autor_id) REFERENCES autores(id) \n    ON DELETE CASCADE  -- Si borro un autor, borro todos sus libros\n);\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4\ufe0f\u20e3-manejo-de-errores-con-integrityerror",children:(0,s.jsxs)(n.strong,{children:["4\ufe0f\u20e3 Manejo de Errores con ",(0,s.jsx)(n.code,{children:"IntegrityError"})]})}),"\n",(0,s.jsxs)(n.p,{children:["Cuando intentamos romper una regla (insertar un duplicado en un campo ",(0,s.jsx)(n.code,{children:"UNIQUE"})," o apuntar a un ID que no existe), Python lanzar\xe1 una excepci\xf3n espec\xedfica."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import sqlite3\n\ntry:\n    with sqlite3.connect("biblioteca.db") as conn:\n        conn.execute("PRAGMA foreign_keys = ON")\n        # Intento de insertar un libro con un autor_id que NO existe\n        conn.execute("INSERT INTO libros (titulo, autor_id) VALUES (?, ?)", ("Inexistente", 999))\nexcept sqlite3.IntegrityError as e:\n    print(f"\u274c Error de integridad detectado: {e}")\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-buenas-pr\xe1cticas-en-dise\xf1o-relacional",children:(0,s.jsx)(n.strong,{children:"\u2705 Buenas pr\xe1cticas en Dise\xf1o Relacional"})}),"\n",(0,s.jsx)(n.admonition,{title:"resumen profesional",type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Normaliza"}),": Si ves que repites mucho un texto (ej: nombres de autores), s\xe1calo a una tabla propia y usa IDs. Ahorra espacio y evita errores de escritura."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Activa siempre el PRAGMA"}),": No conf\xedes en que SQLite lo haga solo. Hazlo nada m\xe1s conectar."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Usa Nombres Claros"}),": Llama a tus claves for\xe1neas con el formato ",(0,s.jsx)(n.code,{children:"tablaPadre_id"})," (ej: ",(0,s.jsx)(n.code,{children:"autor_id"}),") para que sea f\xe1cil seguir el rastro."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Defensa en la Base"}),": Es mejor que la base de datos lance un error (",(0,s.jsx)(n.code,{children:"CHECK"}),", ",(0,s.jsx)(n.code,{children:"UNIQUE"}),") a validar todo mil veces en Python. Delega la seguridad en el esquema."]}),"\n"]})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"-ejercicios-pr\xe1cticos--misi\xf3n-la-cripta-de-datos-parte-4",children:[(0,s.jsx)(n.strong,{children:"\ud83e\uddea Ejercicios pr\xe1cticos"})," \u2013 Misi\xf3n: La Cripta de Datos (Parte 4)"]}),"\n",(0,s.jsxs)(n.p,{children:["La Cripta de Datos est\xe1 creciendo tanto que el sistema actual es un caos. El bibliotecario jefe quiere ",(0,s.jsx)(n.strong,{children:"normalizar"})," la base de datos: separar los libros de sus autores y de sus categor\xedas para evitar duplicados."]}),"\n",(0,s.jsx)(n.h3,{id:"-fase-1--reestructuraci\xf3n-masiva",children:"\ud83d\udfe2 Fase 1 \u2013 Reestructuraci\xf3n Masiva"}),"\n",(0,s.jsx)(n.h4,{id:"-ejercicio-1--el-archivo-de-sabios",children:"\ud83d\udfe9 Ejercicio 1 \u2013 El Archivo de Sabios"}),"\n",(0,s.jsxs)(n.p,{children:["Crea una tabla ",(0,s.jsx)(n.code,{children:"autores"})," (con ",(0,s.jsx)(n.code,{children:"id"})," PK y ",(0,s.jsx)(n.code,{children:"nombre"})," UNIQUE). Crea tambi\xe9n una tabla ",(0,s.jsx)(n.code,{children:"categorias"})," (con ",(0,s.jsx)(n.code,{children:"id"})," PK y ",(0,s.jsx)(n.code,{children:"nombre"})," UNIQUE)."]}),"\n",(0,s.jsx)(n.h4,{id:"-ejercicio-2--libros-conectados",children:"\ud83d\udfe6 Ejercicio 2 \u2013 Libros Conectados"}),"\n",(0,s.jsxs)(n.p,{children:["Modifica el esquema de la tabla ",(0,s.jsx)(n.code,{children:"libros"})," (puedes borrarla y crearla de nuevo) para que no guarde el nombre del autor ni la categor\xeda como texto, sino como ",(0,s.jsx)(n.code,{children:"autor_id"})," y ",(0,s.jsx)(n.code,{children:"categoria_id"}),". Define las ",(0,s.jsx)(n.strong,{children:"Foreign Keys"})," correspondientes y activa el ",(0,s.jsx)(n.code,{children:"PRAGMA foreign_keys = ON"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"-fase-2--blindaje-de-datos",children:"\ud83d\udfe1 Fase 2 \u2013 Blindaje de Datos"}),"\n",(0,s.jsx)(n.h4,{id:"-ejercicio-3--reglas-de-la-orden",children:"\ud83d\udfe8 Ejercicio 3 \u2013 Reglas de la Orden"}),"\n",(0,s.jsxs)(n.p,{children:["A\xf1ade las siguientes restricciones a la tabla ",(0,s.jsx)(n.code,{children:"libros"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["El ",(0,s.jsx)(n.code,{children:"titulo"})," debe ser \xfanico (",(0,s.jsx)(n.code,{children:"UNIQUE"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["El n\xfamero de ",(0,s.jsx)(n.code,{children:"paginas"})," debe ser siempre superior a 0 (",(0,s.jsx)(n.code,{children:"CHECK"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["El ",(0,s.jsx)(n.code,{children:"autor_id"})," no puede ser nulo (",(0,s.jsx)(n.code,{children:"NOT NULL"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"-ejercicio-4--el-detector-de-errores",children:"\ud83d\udfe7 Ejercicio 4 \u2013 El Detector de Errores"}),"\n",(0,s.jsxs)(n.p,{children:["Crea un script que intente realizar las siguientes acciones ilegales y capture el ",(0,s.jsx)(n.code,{children:"IntegrityError"})," mostrando un mensaje personalizado para cada uno:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Insertar un autor que ya existe."}),"\n",(0,s.jsx)(n.li,{children:"Insertar un libro con 0 p\xe1ginas."}),"\n",(0,s.jsxs)(n.li,{children:["Insertar un libro apuntando a un ",(0,s.jsx)(n.code,{children:"autor_id"})," que no existe."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-fase-3--gesti\xf3n-de-despedidas",children:"\ud83d\udd34 Fase 3 \u2013 Gesti\xf3n de Despedidas"}),"\n",(0,s.jsx)(n.h4,{id:"-ejercicio-5--borrado-en-cascada",children:"\ud83d\udfe5 Ejercicio 5 \u2013 Borrado en Cascada"}),"\n",(0,s.jsxs)(n.p,{children:["Configura la relaci\xf3n para que, si un autor es expulsado de la biblioteca secreta y su registro es borrado, todos sus libros desaparezcan autom\xe1ticamente con \xe9l (",(0,s.jsx)(n.code,{children:"ON DELETE CASCADE"}),"). Prueba el funcionamiento insertando un autor, varios libros suyos y luego borrando solo al autor."]}),"\n",(0,s.jsx)(n.h4,{id:"-ejercicio-6--la-gran-consulta-preview",children:"\ud83d\udfea Ejercicio 6 \u2013 La Gran Consulta (Preview)"}),"\n",(0,s.jsxs)(n.p,{children:['Realiza una consulta que muestre por pantalla: "El libro [T\xedtulo] fue escrito por el autor [Nombre]".\n',(0,s.jsxs)(n.em,{children:["(Pista: necesitar\xe1s unir ambas tablas en tu SELECT comparando ",(0,s.jsx)(n.code,{children:"libros.autor_id == autores.id"}),")"]})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var a=r(6540);const s={},i=a.createContext(s);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);