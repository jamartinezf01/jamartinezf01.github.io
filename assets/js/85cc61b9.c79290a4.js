"use strict";(self.webpackChunkp_my_dm=self.webpackChunkp_my_dm||[]).push([[9244],{288:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/consultas","title":"Consultas","description":"Aunque Firebase Realtime Database es una base de datos NoSQL basada en un \xe1rbol JSON, ofrece cierta funcionalidad de consultas para filtrar, ordenar y limitar los datos que obtenemos. A continuaci\xf3n, veremos las principales formas de hacer consultas usando el SDK de Android (Java).","source":"@site/docs/salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/consultas.md","sourceDirName":"salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database","slug":"/salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/consultas","permalink":"/docs/salva/aplicaciones m\xf3viles/5 Persistencia/FireBase/Real Time Database/consultas","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6}}');var o=s(4848),a=s(8453);const l={sidebar_position:6},i="Consultas",d={},c=[{value:"1. <strong>Concepto de Query</strong>",id:"1-concepto-de-query",level:2},{value:"2. <strong>M\xe9todos de Ordenaci\xf3n</strong>",id:"2-m\xe9todos-de-ordenaci\xf3n",level:2},{value:"3. <strong>M\xe9todos de Filtro (Rango)</strong>",id:"3-m\xe9todos-de-filtro-rango",level:2},{value:"4. <strong>M\xe9todos de Limitaci\xf3n (Paginaci\xf3n Sencilla)</strong>",id:"4-m\xe9todos-de-limitaci\xf3n-paginaci\xf3n-sencilla",level:2},{value:"5. <strong>Ejemplos Pr\xe1cticos de Consultas</strong>",id:"5-ejemplos-pr\xe1cticos-de-consultas",level:2},{value:"Ordenar por un Campo y Limitar el N\xfamero de Resultados",id:"ordenar-por-un-campo-y-limitar-el-n\xfamero-de-resultados",level:3},{value:"Filtrar por un Rango de Valores",id:"filtrar-por-un-rango-de-valores",level:3},{value:"Buscar por Valor Exacto",id:"buscar-por-valor-exacto",level:3},{value:"6. <strong>Combinar Consultas con Listeners en Tiempo Real</strong>",id:"6-combinar-consultas-con-listeners-en-tiempo-real",level:2},{value:"7. <strong>Limitaciones de las Consultas</strong>",id:"7-limitaciones-de-las-consultas",level:2}];function t(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"consultas",children:"Consultas"})}),"\n",(0,o.jsxs)(n.p,{children:["Aunque ",(0,o.jsx)(n.strong,{children:"Firebase Realtime Database"})," es una base de datos NoSQL basada en un ",(0,o.jsx)(n.strong,{children:"\xe1rbol JSON"}),", ofrece cierta ",(0,o.jsx)(n.strong,{children:"funcionalidad de consultas"})," para ",(0,o.jsx)(n.strong,{children:"filtrar"}),", ",(0,o.jsx)(n.strong,{children:"ordenar"})," y ",(0,o.jsx)(n.strong,{children:"limitar"})," los datos que obtenemos. A continuaci\xf3n, veremos las principales formas de hacer ",(0,o.jsx)(n.strong,{children:"consultas"})," usando el SDK de Android (Java)."]}),"\n",(0,o.jsxs)(n.p,{children:["Las ",(0,o.jsx)(n.strong,{children:"consultas"})," en ",(0,o.jsx)(n.strong,{children:"Firebase Realtime Database"})," se basan en ",(0,o.jsx)(n.strong,{children:"ordenar"})," los datos por un campo (",(0,o.jsx)(n.code,{children:"orderByChild"}),") y ",(0,o.jsx)(n.strong,{children:"filtrar"})," con m\xe9todos de rango (",(0,o.jsx)(n.code,{children:"startAt"}),", ",(0,o.jsx)(n.code,{children:"endAt"}),", ",(0,o.jsx)(n.code,{children:"equalTo"}),"), adem\xe1s de ",(0,o.jsx)(n.strong,{children:"limitar"})," la cantidad de resultados (",(0,o.jsx)(n.code,{children:"limitToFirst"}),", ",(0,o.jsx)(n.code,{children:"limitToLast"}),"). Aunque no ofrecen la complejidad de un SQL o de Firestore (sin m\xfaltiples filtros o consultas muy avanzadas), s\xed permiten cubrir muchos ",(0,o.jsx)(n.strong,{children:"casos comunes"}),": listas ordenadas, b\xfasqueda por prefijo de cadenas o rango de valores, y paginaciones sencillas."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"1-concepto-de-query",children:["1. ",(0,o.jsx)(n.strong,{children:"Concepto de Query"})]}),"\n",(0,o.jsxs)(n.p,{children:["En Realtime Database, las ",(0,o.jsx)(n.strong,{children:"consultas"})," no se realizan mediante un lenguaje como SQL, sino empleando ",(0,o.jsx)(n.strong,{children:"m\xe9todos encadenados"})," sobre una referencia (",(0,o.jsx)(n.code,{children:"DatabaseReference"}),") para ",(0,o.jsx)(n.strong,{children:"ordenar"})," y ",(0,o.jsx)(n.strong,{children:"filtrar"}),". Estos m\xe9todos devuelven un objeto ",(0,o.jsx)(n.code,{children:"Query"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Ejemplo de patr\xf3n"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'Query consulta = mDatabase.child("anuncios")\r\n    .orderByChild("titulo")\r\n    .startAt("A")    // Empieza donde el campo "titulo" >= "A"\r\n    .endAt("M")      // Termina donde el campo "titulo" <= "M"\r\n    .limitToFirst(10);\n'})}),"\n",(0,o.jsxs)(n.p,{children:["A partir de esa ",(0,o.jsx)(n.code,{children:"consulta"}),", podemos emplear los m\xe9todos de lectura (",(0,o.jsx)(n.code,{children:"addListenerForSingleValueEvent"}),", ",(0,o.jsx)(n.code,{children:"addValueEventListener"}),", etc.) para obtener resultados filtrados."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"2-m\xe9todos-de-ordenaci\xf3n",children:["2. ",(0,o.jsx)(n.strong,{children:"M\xe9todos de Ordenaci\xf3n"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"orderByChild(String path)"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Ordena los resultados en funci\xf3n de un ",(0,o.jsx)(n.strong,{children:"campo hijo"})," espec\xedfico. Por ejemplo, ",(0,o.jsx)(n.code,{children:'orderByChild("precio")'})," ordena los nodos seg\xfan el valor del campo ",(0,o.jsx)(n.code,{children:"precio"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"orderByKey()"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Ordena los resultados seg\xfan la ",(0,o.jsx)(n.strong,{children:"clave"})," (",(0,o.jsx)(n.code,{children:"key"}),") de cada nodo."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"orderByValue()"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Ordena los resultados seg\xfan el ",(0,o.jsx)(n.strong,{children:"valor"})," del nodo en caso de que el nodo sea un valor simple (p.ej., si guardaste un entero o una cadena directamente)."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"orderByPriority()"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Ordena los resultados seg\xfan la ",(0,o.jsx)(n.strong,{children:"prioridad"})," del nodo. (Menos usado; la prioridad es una funcionalidad previa de Realtime Database)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{type:"warning",children:[(0,o.jsx)(n.mdxAdmonitionTitle,{children:(0,o.jsx)(n.strong,{children:"Importante"})}),(0,o.jsxs)(n.p,{children:["Solo ",(0,o.jsx)(n.strong,{children:"una"})," ordenaci\xf3n se puede aplicar por consulta.",(0,o.jsx)(n.br,{}),"\n","No existen las consultas complejas \u201cmultiorden\u201d o \u201cand/or\u201d como en SQL o Firestore."]})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"3-m\xe9todos-de-filtro-rango",children:["3. ",(0,o.jsx)(n.strong,{children:"M\xe9todos de Filtro (Rango)"})]}),"\n",(0,o.jsxs)(n.p,{children:["Una vez que eliges un m\xe9todo de orden (",(0,o.jsx)(n.code,{children:"orderByChild"}),", etc.), puedes acotar los resultados por ",(0,o.jsx)(n.strong,{children:"rango"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"startAt(value)"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Devuelve solo los nodos cuyo valor (o el campo usado en ",(0,o.jsx)(n.code,{children:"orderByChild"}),") es ",(0,o.jsx)(n.strong,{children:"mayor o igual"})," a ",(0,o.jsx)(n.code,{children:"value"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"endAt(value)"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Devuelve solo los nodos cuyo valor es ",(0,o.jsx)(n.strong,{children:"menor o igual"})," a ",(0,o.jsx)(n.code,{children:"value"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"equalTo(value)"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Devuelve solo los nodos cuyo valor es ",(0,o.jsx)(n.strong,{children:"igual"})," a ",(0,o.jsx)(n.code,{children:"value"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Se suelen combinar con ",(0,o.jsx)(n.code,{children:"orderByChild(...)"})," para filtrar seg\xfan un campo en particular."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Ejemplo"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'// Queremos los anuncios en los que "precio" sea >= 10 y <= 50\r\nQuery anunciosConPrecio = mDatabase.child("anuncios")\r\n    .orderByChild("precio")\r\n    .startAt(10)\r\n    .endAt(50);\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"4-m\xe9todos-de-limitaci\xf3n-paginaci\xf3n-sencilla",children:["4. ",(0,o.jsx)(n.strong,{children:"M\xe9todos de Limitaci\xf3n (Paginaci\xf3n Sencilla)"})]}),"\n",(0,o.jsx)(n.p,{children:"Para obtener solo una cantidad determinada de resultados, se usan:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"limitToFirst(int limit)"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Devuelve los ",(0,o.jsx)(n.strong,{children:"primeros"})," ",(0,o.jsx)(n.code,{children:"limit"})," elementos de la lista ordenada."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"limitToLast(int limit)"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Devuelve los ",(0,o.jsx)(n.strong,{children:"\xfaltimos"})," ",(0,o.jsx)(n.code,{children:"limit"})," elementos."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Ejemplo"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'// Pedir los 5 primeros anuncios (seg\xfan orden actual)\r\nQuery primerosCinco = mDatabase.child("anuncios")\r\n    .orderByChild("fecha")\r\n    .limitToFirst(5);\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"5-ejemplos-pr\xe1cticos-de-consultas",children:["5. ",(0,o.jsx)(n.strong,{children:"Ejemplos Pr\xe1cticos de Consultas"})]}),"\n",(0,o.jsx)(n.h3,{id:"ordenar-por-un-campo-y-limitar-el-n\xfamero-de-resultados",children:"Ordenar por un Campo y Limitar el N\xfamero de Resultados"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'DatabaseReference ref = FirebaseDatabase.getInstance().getReference().child("productos");\r\n\r\n// Ordena productos por precio y devuelve solo los primeros 10\r\nQuery consulta = ref.orderByChild("precio").limitToFirst(10);\r\n\r\n// Luego, escuchamos la consulta\r\nconsulta.addListenerForSingleValueEvent(new ValueEventListener() {\r\n    @Override\r\n    public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n        for (DataSnapshot ds : snapshot.getChildren()) {\r\n            Producto producto = ds.getValue(Producto.class);\r\n            if (producto != null) {\r\n                Log.d("Consulta", "Producto: " + producto.getNombre() \r\n                                  + ", Precio: " + producto.getPrecio());\r\n            }\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onCancelled(@NonNull DatabaseError error) {\r\n        Log.e("Consulta", "Error en la consulta", error.toException());\r\n    }\r\n});\n'})}),"\n",(0,o.jsx)(n.h3,{id:"filtrar-por-un-rango-de-valores",children:"Filtrar por un Rango de Valores"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'// Queremos los "anuncios" donde el campo "titulo" empiece por "A" hasta "C"\r\nQuery anunciosA_C = mDatabase.child("anuncios")\r\n    .orderByChild("titulo")\r\n    .startAt("A")\r\n    .endAt("C\\uf8ff"); \r\n// "\\uf8ff" se usa a veces para lograr que incluya cadenas que comienzan con "C"\r\n\r\nanunciosA_C.addListenerForSingleValueEvent(new ValueEventListener() {\r\n    @Override\r\n    public void onDataChange(@NonNull DataSnapshot dataSnapshot) {\r\n        // Recorremos los resultados\r\n    }\r\n\r\n    @Override\r\n    public void onCancelled(@NonNull DatabaseError databaseError) {\r\n    }\r\n});\n'})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Suele usarse el truco ",(0,o.jsx)(n.code,{children:'"\\uf8ff"'})," para abarcar todas las cadenas que inician con un patr\xf3n."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"buscar-por-valor-exacto",children:"Buscar por Valor Exacto"}),"\n",(0,o.jsxs)(n.p,{children:["Si quieres obtener todos los nodos que tengan un campo ",(0,o.jsx)(n.code,{children:"tipo"})," con valor ",(0,o.jsx)(n.code,{children:'"oferta"'}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'Query soloOfertas = mDatabase.child("productos")\r\n    .orderByChild("tipo")\r\n    .equalTo("oferta");\r\n\r\nsoloOfertas.addListenerForSingleValueEvent(new ValueEventListener() {\r\n    ...\r\n});\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"6-combinar-consultas-con-listeners-en-tiempo-real",children:["6. ",(0,o.jsx)(n.strong,{children:"Combinar Consultas con Listeners en Tiempo Real"})]}),"\n",(0,o.jsxs)(n.p,{children:["Las ",(0,o.jsx)(n.strong,{children:"consultas"})," tambi\xe9n pueden usarse con ",(0,o.jsx)(n.code,{children:"addValueEventListener"})," o ",(0,o.jsx)(n.code,{children:"addChildEventListener"})," para recibir actualizaciones din\xe1micas. Por ejemplo:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'Query consultaEnTiempoReal = mDatabase.child("mensajes")\r\n    .orderByChild("timestamp")\r\n    .limitToLast(20);\r\n\r\nconsultaEnTiempoReal.addValueEventListener(new ValueEventListener() {\r\n    @Override\r\n    public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n        // Recibir los 20 \xfaltimos mensajes, y se actualizar\xe1 \r\n        // autom\xe1ticamente a medida que lleguen nuevos\r\n    }\r\n\r\n    @Override\r\n    public void onCancelled(@NonNull DatabaseError error) {}\r\n});\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"7-limitaciones-de-las-consultas",children:["7. ",(0,o.jsx)(n.strong,{children:"Limitaciones de las Consultas"})]}),"\n",(0,o.jsx)(n.admonition,{title:"consultas en realtime database",type:"warning",children:(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Una sola ordenaci\xf3n"})," por consulta."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Filtros sencillos"})," (",(0,o.jsx)(n.code,{children:"startAt"}),", ",(0,o.jsx)(n.code,{children:"endAt"}),", ",(0,o.jsx)(n.code,{children:"equalTo"}),"). No hay operadores como ",(0,o.jsx)(n.code,{children:"AND"}),", ",(0,o.jsx)(n.code,{children:"OR"}),", m\xfaltiples condiciones ni b\xfasquedas complejas."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Indices"}),": Para grandes conjuntos de datos, puede ser necesario ",(0,o.jsx)(n.a,{href:"https://firebase.google.com/docs/database/security/indexing-data",children:"crear \xedndices"})," en las reglas de seguridad para mejorar el rendimiento."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Funcionalidad"}),": Menos potente que Firestore a nivel de queries. Si necesitas consultas muy complejas, tal vez Firestore se ajuste mejor."]}),"\n"]})}),"\n",(0,o.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var r=s(6540);const o={},a=r.createContext(o);function l(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);