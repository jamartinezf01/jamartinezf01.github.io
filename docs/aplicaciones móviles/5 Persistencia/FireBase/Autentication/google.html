<!doctype html>
<html lang="es" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-aplicaciones móviles/5 Persistencia/FireBase/Autentication/google" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Ejemplo Google-LogIn | Apuntes de Informática.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jamfdev.github.io/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/google"><meta data-rh="true" property="og:locale" content="es"><meta data-rh="true" name="docusaurus_locale" content="es"><meta data-rh="true" name="docsearch:language" content="es"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ejemplo Google-LogIn | Apuntes de Informática."><meta data-rh="true" name="description" content="A continuación, se describe el proceso paso a paso para añadir la posibilidad de registrarse (o iniciar sesión) en tu app de Android mediante la cuenta de Google usando Firebase Authentication. Asumimos que ya tienes configurado tu proyecto con Firebase (dependencias, google-services.json, etc.) y que dispones de FirebaseAuth para correo/contraseña. Veamos qué necesitas hacer para integrar Google Sign-In."><meta data-rh="true" property="og:description" content="A continuación, se describe el proceso paso a paso para añadir la posibilidad de registrarse (o iniciar sesión) en tu app de Android mediante la cuenta de Google usando Firebase Authentication. Asumimos que ya tienes configurado tu proyecto con Firebase (dependencias, google-services.json, etc.) y que dispones de FirebaseAuth para correo/contraseña. Veamos qué necesitas hacer para integrar Google Sign-In."><link data-rh="true" rel="icon" href="/img/logo-PMDM.ico"><link data-rh="true" rel="canonical" href="https://jamfdev.github.io/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/google"><link data-rh="true" rel="alternate" href="https://jamfdev.github.io/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/google" hreflang="es"><link data-rh="true" rel="alternate" href="https://jamfdev.github.io/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/google" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apuntes de Informática. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apuntes de Informática. Atom Feed">




<meta httpequiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta httpequiv="Pragma" content="no-cache">
<meta httpequiv="Expires" content="0">

<script src="/version.js"></script><link rel="stylesheet" href="/assets/css/styles.0c83d892.css">
<script src="/assets/js/runtime~main.bb52eb56.js" defer="defer"></script>
<script src="/assets/js/main.2e8d801f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Saltar al contenido principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Saltar al contenido principal</a></div><nav aria-label="Principal" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Alternar barra lateral" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Inicio</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/ut5---persistencia">PM y DM</a><a class="navbar__item navbar__link" href="/docs/category/ut3---java-script">LMSGI</a></div><div class="navbar__items navbar__items--right"><a href="https://moodle.educarex.es/evex/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">EVEx<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Cambiar entre modo oscuro y claro (actualmente modo claro)" aria-label="Cambiar entre modo oscuro y claro (actualmente modo claro)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Volver al principio" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Barra lateral de Documentos" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/ut5---persistencia">UT5 - Persistencia</a><button aria-label="Colapsar categoría &#x27;UT5 - Persistencia&#x27; de la barra lateral" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/5.1 Conceptos Fundamentales">5.1 Conceptos Fundamentales</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/5.2 Shared Preferences">5.2 SharedPreferences</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/Room">5.3 Room</a><button aria-label="Ampliar la categoría &#x27;5.3 Room&#x27; de la barra lateral" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase">5.4 FireBase</a><button aria-label="Colapsar categoría &#x27;5.4 FireBase&#x27; de la barra lateral" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication">5.4.1 Authentication</a><button aria-label="Colapsar categoría &#x27;5.4.1 Authentication&#x27; de la barra lateral" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/configuracion">Configuración</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/integracion">Código de integración en Android</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/ejemplo">Ejemplo Email-Password</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/google">Ejemplo Google-LogIn</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Real Time Database">5.4.2 Real Time DataBase</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Firestore">5.4.3 Firestore</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Rastro de navegación"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Página de Inicio" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/ut5---persistencia"><span itemprop="name">UT5 - Persistencia</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/aplicaciones móviles/5 Persistencia/FireBase"><span itemprop="name">5.4 FireBase</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication"><span itemprop="name">5.4.1 Authentication</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ejemplo Google-LogIn</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">En esta página</button></div><div class="theme-doc-markdown markdown"><header><h1>Ejemplo Google-LogIn</h1></header>
<p>A continuación, se describe el <strong>proceso paso a paso</strong> para <strong>añadir la posibilidad de registrarse</strong> (o iniciar sesión) en tu app de Android mediante la <strong>cuenta de Google</strong> usando <strong>Firebase Authentication</strong>. Asumimos que ya tienes configurado tu proyecto con Firebase (dependencias, <code>google-services.json</code>, etc.) y que dispones de <strong>FirebaseAuth</strong> para correo/contraseña. Veamos qué necesitas hacer para <strong>integrar Google Sign-In</strong>.</p>
<div style="margin:0 auto;width:250px"><p><img decoding="async" loading="lazy" alt="Presentación de la 2ª version de la app de autenticación" src="/assets/images/Autenticacion_v2-bca386f129eea008f4faf13b835f45c3.gif" title="Presentación de la 2ª version de la app de autenticación" width="378" height="840" class="img_ev3q"></p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-habilitar-google-como-proveedor">1. <strong>Habilitar Google como proveedor</strong><a href="#1-habilitar-google-como-proveedor" class="hash-link" aria-label="Enlace directo al 1-habilitar-google-como-proveedor" title="Enlace directo al 1-habilitar-google-como-proveedor">​</a></h2>
<ol>
<li>Accede a la <a href="https://console.firebase.google.com/" target="_blank" rel="noopener noreferrer">Consola de Firebase</a>.</li>
<li>Selecciona tu <strong>proyecto</strong> y ve al menú <strong>Authentication</strong> en la barra lateral.</li>
<li>En la pestaña <strong>Método de inicio de sesión</strong>, busca la opción <strong>Google</strong> y <strong>actívala</strong>.</li>
<li>Asegúrate de tener configurada la información del <strong>ID de cliente de OAuth 2.0</strong> para Android (generalmente se configura automáticamente si has añadido la aplicación Android en Firebase y has subido el <strong>SHA1</strong> de tu keystore).</li>
</ol>
<div style="margin:0 auto;width:1000px"><p><img decoding="async" loading="lazy" alt="Selecciona Google como nuevo proveedor de autenticación" src="/assets/images/agregarGoogle-254a5d2ced5bb64fb2030a97b953f8b4.png" title="Selecciona Google como nuevo proveedor de autenticación" width="1610" height="702" class="img_ev3q"></p></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>nota</div><div class="admonitionContent_BuS1"><p>Si no has agregado la <strong>SHA-1</strong> de tu keystore en la consola de Firebase, hazlo en la sección <strong>Configuración del proyecto</strong> &gt; pestaña <strong>Tus apps</strong> (haz clic en la aplicación Android). Esto puede requerirse para que la autenticación con Google funcione correctamente.</p></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-agregar-huellas-digitales-a-tu-proyecto">2. <strong>Agregar huellas digitales a tu proyecto</strong><a href="#2-agregar-huellas-digitales-a-tu-proyecto" class="hash-link" aria-label="Enlace directo al 2-agregar-huellas-digitales-a-tu-proyecto" title="Enlace directo al 2-agregar-huellas-digitales-a-tu-proyecto">​</a></h2>
<p>En el contexto de <strong>Firebase</strong> (y, en general, de cualquier servicio de Google que requiera OAuth 2.0), las <strong>“huellas digitales”</strong> (o <strong>App Signatures</strong>) se refieren a los <strong>códigos hash</strong> (SHA-1, SHA-256, etc.) que identifican la clave con la que <strong>estás firmando</strong> tu app Android. Firebase (y Google) usan estas huellas para verificar que la app que envía solicitudes o que solicita un inicio de sesión OAuth (por ejemplo, con Google Sign-In) sea realmente <strong>tu</strong> aplicación y no otra.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="por-qué-son-necesarias-las-huellas-digitales">¿Por qué son necesarias las huellas digitales?<a href="#por-qué-son-necesarias-las-huellas-digitales" class="hash-link" aria-label="Enlace directo al ¿Por qué son necesarias las huellas digitales?" title="Enlace directo al ¿Por qué son necesarias las huellas digitales?">​</a></h3>
<ol>
<li><strong>Seguridad</strong>: Permiten a Firebase (o Google) <strong>asegurarse</strong> de que el paquete y la firma de la app coinciden con lo que has configurado en tu proyecto.</li>
<li><strong>Autorización</strong>: Para algunos servicios de Google (como Google Sign-In, Google Maps, etc.), se requiere que la <strong>clave SHA</strong> de tu app coincida con la clave almacenada en la consola, de modo que tus usuarios puedan iniciar sesión o utilizar esas APIs con éxito.</li>
</ol>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tipos-de-huellas-digitales">Tipos de huellas digitales<a href="#tipos-de-huellas-digitales" class="hash-link" aria-label="Enlace directo al Tipos de huellas digitales" title="Enlace directo al Tipos de huellas digitales">​</a></h3>
<ol>
<li>
<p><strong>Debug</strong>:</p>
<ul>
<li>Cuando ejecutas tu app desde Android Studio en modo debug, se usa una keystore <strong>automática</strong> (debug keystore).</li>
<li>Tiene una <strong>SHA-1</strong> y <strong>SHA-256</strong> específicas.</li>
<li>Se regeneran al reinstalar Android Studio, por lo que es normal compartir una sola huella con tu equipo si todos usan la misma debug keystore.</li>
</ul>
</li>
<li>
<p><strong>Release</strong>:</p>
<ul>
<li>Cuando compilas la versión final de la app para subirla a Play Store, usas <strong>tu propia keystore</strong> (release keystore) con su <strong>contraseña</strong> y alias único.</li>
<li>Esta keystore tendrá su propia huella digital <strong>SHA-1</strong> y <strong>SHA-256</strong>.</li>
<li>Es fundamental guardar esta keystore en un lugar seguro, ya que te identifica de manera <strong>única</strong> como desarrollador de esa app.</li>
</ul>
</li>
</ol>
<p>En <strong>Firebase</strong> generalmente la más relevante es la <strong>SHA-1</strong>, aunque muchos servicios también requieren la <strong>SHA-256</strong>.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cómo-obtener-tus-huellas-digitales">¿Cómo obtener tus huellas digitales?<a href="#cómo-obtener-tus-huellas-digitales" class="hash-link" aria-label="Enlace directo al ¿Cómo obtener tus huellas digitales?" title="Enlace directo al ¿Cómo obtener tus huellas digitales?">  ​</a></h3>
<p>Para obtener la keystore <strong>automática</strong> de tu proyecto (debug keystore) deberás emplear el comanfo Java <code>keytool</code> en tu terminal:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">keytool -list -v -alias androiddebugkey -keystore %USERPROFILE%\.android\debug.keystore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>El resultado mostrará la <strong>SHA1</strong>, <strong>SHA-256</strong> y otras.<br>
<!-- -->Este comando también te sirve para la <strong>debug keystore</strong> ubicada en:</p>
<ul>
<li>Windows: <code>C:\Users\&lt;username&gt;\.android\debug.keystore</code></li>
<li>macOS/Linux: <code>~/.android/debug.keystore</code><br>
<!-- -->La contraseña por defecto de la debug keystore suele ser <code>android</code>.</li>
</ul>
<p>por ejemplo...</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">keytool -list -v -alias androiddebugkey -keystore c:\users\josea\.android\debug.keystore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>En caso de que quieras usar <strong>tu propia keystore</strong> (release keystore) con su <strong>contraseña</strong> y alias único para poder subir tu App al PlayStore consulta las instrucciones en la <a href="https://developers.google.com/android/guides/client-auth?hl=es-419" target="_blank" rel="noopener noreferrer">Documentación de Firebase</a>.</p></div></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cómo-se-agregan-a-firebase">¿Cómo se agregan a Firebase?<a href="#cómo-se-agregan-a-firebase" class="hash-link" aria-label="Enlace directo al ¿Cómo se agregan a Firebase?" title="Enlace directo al ¿Cómo se agregan a Firebase?">​</a></h3>
<ol>
<li>Ve a la <a href="https://console.firebase.google.com/" target="_blank" rel="noopener noreferrer">Consola de Firebase</a> y selecciona tu proyecto.</li>
<li>En la <strong>Configuración del proyecto</strong> (icono de engranaje, parte superior izquierda), elige la pestaña <strong>Tus apps</strong>.</li>
<li>Selecciona tu <strong>app Android</strong> (generalmente un recuadro con tu packageName).</li>
<li>En <strong>Certificados de firma SHA</strong>, haz clic en <strong>Agregar huella digital</strong> (o <strong>Add Fingerprint</strong>).</li>
<li>Pega tu <strong>SHA-1</strong> (y/o <strong>SHA-256</strong>) en el campo correspondiente.</li>
<li>Guarda los cambios.</li>
</ol>
<div style="margin:0 auto;width:1000px"><p><img decoding="async" loading="lazy" alt="Selecciona Google como nuevo proveedor de autenticación" src="/assets/images/agregarHuella-1560cf59436da3128b3701dd06a90e13.png" title="Selecciona Google como nuevo proveedor de autenticación" width="957" height="714" class="img_ev3q"></p></div>
<blockquote>
<p>Si cambias de debug keystore, o creas una nueva release keystore, tendrás que <strong>actualizar</strong> los valores en la consola de Firebase.</p>
</blockquote>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>No te olvides...</div><div class="admonitionContent_BuS1"><p>No te olvides de volver a descargar el archivo <code>google-services.json</code> y sustituir el de tu proyecto por el nuevo.</p></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-agregar-las-dependencias">3. <strong>Agregar las dependencias</strong><a href="#3-agregar-las-dependencias" class="hash-link" aria-label="Enlace directo al 3-agregar-las-dependencias" title="Enlace directo al 3-agregar-las-dependencias">​</a></h2>
<p>En tu <strong>módulo app</strong>  <code>build.gradle.kts</code>, asegúrate de tener:</p>
<div class="language-kotin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotin codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dependencies {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Firebase Authentication (ya lo tendrás si has implementado correo/contraseña)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    implementation (&quot;com.google.firebase:firebase-auth:21.3.0&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Google Sign In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    implementation (&quot;com.google.android.gms:play-services-auth:20.6.0&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Ajusta las versiones según sea necesario. Después, sincroniza el proyecto.</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-configurar-googlesigninclient">4. <strong>Configurar GoogleSignInClient</strong><a href="#4-configurar-googlesigninclient" class="hash-link" aria-label="Enlace directo al 4-configurar-googlesigninclient" title="Enlace directo al 4-configurar-googlesigninclient">​</a></h2>
<p>En la <strong>Activity</strong> donde quieras gestionar la autenticación con Google (por ejemplo, tu <code>RegistroActivity</code> o una actividad dedicada al login), configura el <strong>cliente</strong> de Google para obtener el token de ID necesario para autenticarte con Firebase.</p>
<ul>
<li><strong>Obtener el ID de cliente web</strong>:<!-- -->
<ul>
<li>Ve a la <a href="https://console.firebase.google.com/" target="_blank" rel="noopener noreferrer">Consola de Firebase</a>, en la opción de <strong>Métodos de acceso</strong> selecciona editar método Google.</li>
<li>Ubica el <strong>Web client (auto-created)</strong>, copia la <strong>Client ID</strong>.</li>
<li>Guárdala en <code>strings.xml</code> o en una constante.</li>
</ul>
</li>
</ul>
<div style="margin:0 auto;width:1000px"><p><img decoding="async" loading="lazy" alt="Ubica Web Client" src="/assets/images/webClient-9ee5bb3a37bcb26663bfe8e4d889746a.png" title="Ubica Web Client" width="1838" height="898" class="img_ev3q"></p></div>
<p>Por ejemplo, en tu archivo <code>res/values/strings.xml</code>:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">resources</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">string</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">default_web_client_id</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">693313429676-gsj0il1smgqigts57v6qms39a704gakk.apps.googleusercontent.com</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">string</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">resources</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-añadir-un-botón-para-iniciar-sesión-con-google">5. <strong>Añadir un botón para Iniciar sesión con Google</strong><a href="#5-añadir-un-botón-para-iniciar-sesión-con-google" class="hash-link" aria-label="Enlace directo al 5-añadir-un-botón-para-iniciar-sesión-con-google" title="Enlace directo al 5-añadir-un-botón-para-iniciar-sesión-con-google">​</a></h2>
<p>Agrega un botón en tu layout (puede ser un <strong>Button</strong> normal o el <strong>SignInButton</strong> de Google). Por ejemplo, en tu <code>activity_register.xml</code>:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">com.google.android.gms.common.SignInButton</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">android:</span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">@+id/btnGoogleSignIn</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">android:</span><span class="token tag attr-name" style="color:#00a4db">layout_width</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">wrap_content</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">android:</span><span class="token tag attr-name" style="color:#00a4db">layout_height</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">wrap_content</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">android:</span><span class="token tag attr-name" style="color:#00a4db">layout_marginTop</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">16dp</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">android:</span><span class="token tag attr-name" style="color:#00a4db">text</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Iniciar con Google</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">app:</span><span class="token tag attr-name" style="color:#00a4db">layout_constraintEnd_toEndOf</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">parent</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">app:</span><span class="token tag attr-name" style="color:#00a4db">layout_constraintStart_toStartOf</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">parent</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">app:</span><span class="token tag attr-name" style="color:#00a4db">layout_constraintTop_toBottomOf</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">@+id/btnRegistro</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>En tu Activity, obtén la referencia del botón y asigna un <code>setOnClickListener</code> que llame a un método para iniciar el flujo:</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-modificar-la-registroactivity">6. <strong>Modificar la <code>RegistroActivity</code></strong><a href="#6-modificar-la-registroactivity" class="hash-link" aria-label="Enlace directo al 6-modificar-la-registroactivity" title="Enlace directo al 6-modificar-la-registroactivity">​</a></h2>
<p>Ahora, procederemos a modificar tu <code>RegistroActivity.java</code> para incluir la funcionalidad de Google Sign-In utilizando la nueva API de resultados de actividad (<code>ActivityResultLauncher</code>).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="código-completo">Código completo<a href="#código-completo" class="hash-link" aria-label="Enlace directo al Código completo" title="Enlace directo al C ódigo completo">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">RegistroActivity.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">com</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">agora</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">autenticaciondemo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">androidx</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">activity</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">result</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">ActivityResult</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">androidx</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">activity</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">result</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">ActivityResultCallback</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">androidx</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">activity</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">result</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">ActivityResultLauncher</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">androidx</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">activity</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">result</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">contract</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">ActivityResultContracts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">androidx</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">NonNull</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">androidx</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">appcompat</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">app</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">AppCompatActivity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">app</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Activity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">content</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Intent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">os</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Bundle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">view</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">View</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">widget</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Toast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">agora</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">autenticaciondemo</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">databinding</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">ActivityRegistroBinding</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">gms</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">api</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">signin</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">gms</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">common</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">api</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">ApiException</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">gms</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">tasks</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">firebase</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">FirebaseApp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">firebase</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * RegistroActivity maneja el registro e inicio de sesión con Firebase Authentication,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * incluyendo la opción de iniciar sesión con Google.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RegistroActivity</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">AppCompatActivity</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">ActivityRegistroBinding</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">FirebaseAuth</span><span class="token plain"> mAuth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Cliente de Google Sign-In</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">GoogleSignInClient</span><span class="token plain"> mGoogleSignInClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Launcher para manejar el resultado de la Intent de Google Sign-In</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">ActivityResultLauncher</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Intent</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> googleSignInLauncher</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Bundle</span><span class="token plain"> savedInstanceState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">onCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">savedInstanceState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Inicializar View Binding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        binding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ActivityRegistroBinding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inflate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getLayoutInflater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setContentView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Inicializar Firebase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FirebaseApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initializeApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mAuth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">FirebaseAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Configurar Google Sign-In</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">configurarGoogleSignIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Registrar el launcher para manejar el resultado de Google Sign-In</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">registrarLauncherGoogleSignIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Click en &quot;Iniciar Sesión&quot; (Correo/Contraseña)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">btnLogin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">View</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">View</span><span class="token plain"> view</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">logarUsuario</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Click en &quot;Registrarse&quot; (Correo/Contraseña)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">btnRegistro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">View</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">View</span><span class="token plain"> view</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">crearUsuario</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Click en &quot;Iniciar con Google&quot;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">btnGoogleSignIn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">View</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">View</span><span class="token plain"> view</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">iniciarSignInConGoogle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Configura las opciones de Google Sign-In.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">configurarGoogleSignIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Configurar las opciones de inicio de sesión de Google</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">GoogleSignInOptions</span><span class="token plain"> gso </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">GoogleSignInOptions</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Builder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GoogleSignInOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DEFAULT_SIGN_IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">requestIdToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">default_web_client_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ID del cliente web de Firebase</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">requestEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Solicitar el email del usuario</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Crear el cliente de Google Sign-In con las opciones configuradas</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        mGoogleSignInClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GoogleSignIn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gso</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Registra el launcher para manejar el resultado de Google Sign-In.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registrarLauncherGoogleSignIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        googleSignInLauncher </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registerForActivityResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ActivityResultContracts</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">StartActivityForResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ActivityResultCallback</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">ActivityResult</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onActivityResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ActivityResult</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Verificar si el resultado es exitoso</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getResultCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token class-name">Activity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RESULT_OK</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">Intent</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">GoogleSignInAccount</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GoogleSignIn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSignedInAccountFromIntent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                </span><span class="token comment" style="color:#999988;font-style:italic">// Obtener la cuenta de Google del resultado</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                </span><span class="token class-name">GoogleSignInAccount</span><span class="token plain"> account </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ApiException</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">account </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token comment" style="color:#999988;font-style:italic">// Autenticar con Firebase usando el token de Google</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token function" style="color:#d73a49">autenticarConFirebaseGoogle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">account</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getIdToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ApiException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                </span><span class="token comment" style="color:#999988;font-style:italic">// Manejar error en Google Sign-In</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token string" style="color:#e3116c">&quot;Error al iniciar con Google: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// El usuario canceló el inicio de sesión con Google</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token string" style="color:#e3116c">&quot;Inicio de sesión con Google cancelado.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Inicia el flujo de inicio de sesión con Google.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">iniciarSignInConGoogle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Crear la Intent de Google Sign-In</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Intent</span><span class="token plain"> signInIntent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mGoogleSignInClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSignInIntent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Lanzar la Intent utilizando el launcher registrado</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        googleSignInLauncher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">launch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signInIntent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Maneja la autenticación con Firebase usando el token de Google.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param idToken El token de ID obtenido de Google Sign-In.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">autenticarConFirebaseGoogle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> idToken</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Crear credenciales de Firebase con el token de Google</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">AuthCredential</span><span class="token plain"> credential </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GoogleAuthProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCredential</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">idToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Iniciar sesión con las credenciales</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signInWithCredential</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">credential</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addOnCompleteListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">OnCompleteListener</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">AuthResult</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onComplete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token annotation punctuation" style="color:#393A34">@NonNull</span><span class="token plain"> </span><span class="token class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">AuthResult</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isSuccessful</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Inicio de sesión exitoso</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">FirebaseUser</span><span class="token plain"> usuario </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usuario </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token string" style="color:#e3116c">&quot;Bienvenido con Google: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> usuario</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Navegar a MainActivity</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token function" style="color:#d73a49">iniciarMainActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Error al autenticar con Firebase</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token string" style="color:#e3116c">&quot;Error al autenticar con Firebase: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Crea un nuevo usuario en Firebase (Email/Password).</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">crearUsuario</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textoMail</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textoPassword</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> password2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textoPassword2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> password2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Por favor, completa todos los campos&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">password2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Las contraseñas no coinciden&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createUserWithEmailAndPassword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addOnCompleteListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">OnCompleteListener</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">AuthResult</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onComplete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token annotation punctuation" style="color:#393A34">@NonNull</span><span class="token plain"> </span><span class="token class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">AuthResult</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isSuccessful</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Usuario creado por primera vez</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">FirebaseUser</span><span class="token plain"> usuario </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usuario </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token string" style="color:#e3116c">&quot;Bienvenido, nuevo usuario: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> usuario</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Pasamos a la actividad principal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token function" style="color:#d73a49">iniciarMainActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Falla en la creación de usuario (e.g., email ya en uso)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token string" style="color:#e3116c">&quot;Error al crear usuario: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Inicia sesión con un usuario existente.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">logarUsuario</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textoMail</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textoPassword</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Por favor, completa todos los campos&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signInWithEmailAndPassword</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addOnCompleteListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">OnCompleteListener</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">AuthResult</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onComplete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token annotation punctuation" style="color:#393A34">@NonNull</span><span class="token plain"> </span><span class="token class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">AuthResult</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isSuccessful</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Usuario existente</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">FirebaseUser</span><span class="token plain"> usuario </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usuario </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token string" style="color:#e3116c">&quot;Bienvenido de nuevo: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> usuario</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Pasamos a la actividad principal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token function" style="color:#d73a49">iniciarMainActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Error al iniciar sesión</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token string" style="color:#e3116c">&quot;Error al iniciar sesión: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Navega a la MainActivity</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">iniciarMainActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Intent</span><span class="token plain"> intent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Intent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">MainActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">startActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">intent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Comprueba si ya hay un usuario autenticado y navega directamente a MainActivity si es así.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Este método se llama en onStart para mantener la sesión iniciada.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">onStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FirebaseUser</span><span class="token plain"> usuarioActual </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usuarioActual </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Usuario ya está autenticado, navegar a MainActivity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">iniciarMainActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="explicación-detallada">Explicación detallada<a href="#explicación-detallada" class="hash-link" aria-label="Enlace directo al Explicación detallada" title="Enlace directo al Explicación detallada">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>A continuación, se desarrolla una <strong>explicación detallada</strong> de las <strong>partes resaltadas</strong> en el código <code>RegistroActivity.java</code>. Estas secciones son fundamentales para integrar <strong>Google Sign-In</strong> en tu aplicación Android utilizando <strong>Firebase Authentication</strong> y la <strong>nueva API de resultados de actividad</strong> (<code>ActivityResultLauncher</code>).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="declaración-de-variables-clave">Declaración de Variables Clave<a href="#declaración-de-variables-clave" class="hash-link" aria-label="Enlace directo al Declaración de Variables Clave" title="Enlace directo al Declaración de Variables Clave">​</a></h4><p>En tu clase <code>RegistroActivity</code>, has declarado dos variables clave que son esenciales para la integración de Google Sign-In:</p><ul>
<li>
<p><strong><code>GoogleSignInClient mGoogleSignInClient</code></strong>:</p>
<ul>
<li><strong>¿Qué es?</strong>: Es una instancia de <code>GoogleSignInClient</code> que gestiona el flujo de autenticación de Google Sign-In.</li>
<li><strong>Función</strong>: Facilita la creación de la <code>Intent</code> necesaria para iniciar el proceso de inicio de sesión con Google y proporciona métodos para cerrar la sesión de Google.</li>
</ul>
</li>
<li>
<p><strong><code>ActivityResultLauncher&lt;Intent&gt; googleSignInLauncher</code></strong>:</p>
<ul>
<li><strong>¿Qué es?</strong>: Es un launcher que utiliza la <strong>nueva API de resultados de actividad</strong> (<code>ActivityResultLauncher</code>) para manejar los resultados de las actividades iniciadas.</li>
<li><strong>Función</strong>: Reemplaza al método obsoleto <code>startActivityForResult()</code>, proporcionando una forma más limpia y modular de manejar los resultados de actividades, como el flujo de Google Sign-In.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuración-de-google-sign-in">Configuración de Google Sign-In<a href="#configuración-de-google-sign-in" class="hash-link" aria-label="Enlace directo al Configuración de Google Sign-In" title="Enlace directo al Configuración de Google Sign-In">​</a></h4><p>Dentro del método <code>onCreate()</code>, llamas a dos métodos cruciales:</p><ul>
<li>
<p><strong><code>configurarGoogleSignIn()</code></strong>:</p>
<ul>
<li><strong>Propósito</strong>: Configura las opciones necesarias para Google Sign-In, como solicitar el ID Token y el email del usuario.</li>
<li><strong>Importancia</strong>: Establece las configuraciones que permiten a tu aplicación comunicarse correctamente con los servicios de Google y Firebase para la autenticación.</li>
</ul>
</li>
<li>
<p><strong><code>registrarLauncherGoogleSignIn()</code></strong>:</p>
<ul>
<li><strong>Propósito</strong>: Registra el <code>ActivityResultLauncher</code> que manejará el resultado de la <code>Intent</code> de Google Sign-In.</li>
<li><strong>Importancia</strong>: Define cómo manejar la respuesta de Google después de que el usuario intente iniciar sesión, ya sea exitosamente o cancelando el proceso.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="registro-del-launcher-para-manejar-resultados-de-google-sign-in">Registro del Launcher para Manejar Resultados de Google Sign-In<a href="#registro-del-launcher-para-manejar-resultados-de-google-sign-in" class="hash-link" aria-label="Enlace directo al Registro del Launcher para Manejar Resultados de Google Sign-In" title="Enlace directo al Registro del Launcher para Manejar Resultados de Google Sign-In">​</a></h4><p>En el método <code>registrarLauncherGoogleSignIn()</code>, registras el launcher que manejará el resultado de la <code>Intent</code> de Google Sign-In:</p><ul>
<li>
<p><strong><code>registerForActivityResult</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Registra un callback que se ejecutará cuando se reciba un resultado de la actividad iniciada.</li>
<li><strong>Parámetros</strong>:<!-- -->
<ul>
<li><strong><code>ActivityResultContracts.StartActivityForResult()</code></strong>: Define el tipo de contrato que especifica que se iniciará una actividad esperando un resultado.</li>
<li><strong><code>ActivityResultCallback&lt;ActivityResult&gt;()</code></strong>: Define cómo manejar el resultado una vez que la actividad finalice.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Callback <code>onActivityResult(ActivityResult result)</code></strong>:</p>
<ul>
<li><strong>Verificación del Resultado</strong>:<!-- -->
<ul>
<li><strong>Éxito (<code>RESULT_OK</code>)</strong>: Significa que el usuario completó el flujo de Google Sign-In exitosamente.<!-- -->
<ul>
<li><strong>Obtención de Datos</strong>: Se extrae la <code>Intent</code> que contiene la información de la cuenta de Google.</li>
<li><strong>Extracción de la Cuenta</strong>: Utiliza <code>GoogleSignIn.getSignedInAccountFromIntent(data)</code> para obtener la cuenta de Google del usuario.</li>
<li><strong>Autenticación con Firebase</strong>: Si la cuenta es válida, se llama al método <code>autenticarConFirebaseGoogle(account.getIdToken())</code> para autenticar al usuario en Firebase usando el token de Google.</li>
</ul>
</li>
<li><strong>Cancelación o Error</strong>: Si el usuario canceló el inicio de sesión o ocurrió un error, se muestra un mensaje adecuado.</li>
</ul>
</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementación-del-listener-para-el-botón-de-google-sign-in">Implementación del Listener para el Botón de Google Sign-In<a href="#implementación-del-listener-para-el-botón-de-google-sign-in" class="hash-link" aria-label="Enlace directo al Implementación del Listener para el Botón de Google Sign-In" title="Enlace directo al Implementación del Listener para el Botón de Google Sign-In">​</a></h4><p>Añades un <strong>listener</strong> para el botón de Google Sign-In que inicia el flujo de autenticación:</p><ul>
<li><strong><code>binding.btnGoogleSignIn.setOnClickListener</code></strong>:<!-- -->
<ul>
<li><strong>Función</strong>: Asigna una acción al botón de Google Sign-In.</li>
<li><strong>Acción</strong>: Cuando el usuario hace clic en el botón, se llama al método <code>iniciarSignInConGoogle()</code>, que inicia el proceso de autenticación con Google.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="método-configurargooglesignin">Método <code>configurarGoogleSignIn()</code><a href="#método-configurargooglesignin" class="hash-link" aria-label="Enlace directo al método-configurargooglesignin" title="Enlace directo al método-configurargooglesignin">​</a></h4><p>Este método configura las opciones de Google Sign-In y crea una instancia de <code>GoogleSignInClient</code>:</p><ul>
<li>
<p><strong><code>GoogleSignInOptions.Builder</code></strong>:</p>
<ul>
<li><strong><code>GoogleSignInOptions.DEFAULT_SIGN_IN</code></strong>: Configura el inicio de sesión de Google con las opciones predeterminadas.</li>
<li><strong><code>requestIdToken(getString(R.string.default_web_client_id))</code></strong>:<!-- -->
<ul>
<li><strong>Propósito</strong>: Solicita un <strong>ID Token</strong> que es necesario para autenticar al usuario con Firebase.</li>
<li><strong><code>default_web_client_id</code></strong>: Es un string que contiene el ID de cliente web generado por Firebase. Este valor debe estar definido en tu archivo <code>strings.xml</code> y se obtiene automáticamente al configurar Google Sign-In en la consola de Firebase.</li>
</ul>
</li>
<li><strong><code>requestEmail()</code></strong>:<!-- -->
<ul>
<li><strong>Propósito</strong>: Solicita el email del usuario, que es necesario para identificar al usuario en Firebase.</li>
</ul>
</li>
<li><strong><code>build()</code></strong>: Construye las opciones de Google Sign-In con las configuraciones especificadas.</li>
</ul>
</li>
<li>
<p><strong><code>GoogleSignIn.getClient(this, gso)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Crea una instancia de <code>GoogleSignInClient</code> utilizando las opciones configuradas.</li>
<li><strong>Uso</strong>: Esta instancia se utiliza para iniciar el flujo de inicio de sesión de Google y para cerrar la sesión de Google cuando sea necesario.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="método-registrarlaunchergooglesignin">Método <code>registrarLauncherGoogleSignIn()</code><a href="#método-registrarlaunchergooglesignin" class="hash-link" aria-label="Enlace directo al método-registrarlaunchergooglesignin" title="Enlace directo al método-registrarlaunchergooglesignin">​</a></h4><p>Este método registra el <code>ActivityResultLauncher</code> que manejará el resultado de la <code>Intent</code> de Google Sign-In:</p><ul>
<li>
<p><strong><code>registerForActivityResult</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Registra un callback que se ejecutará cuando se reciba un resultado de la actividad iniciada (en este caso, el flujo de Google Sign-In).</li>
<li><strong>Parámetros</strong>:<!-- -->
<ul>
<li><strong><code>ActivityResultContracts.StartActivityForResult()</code></strong>: Especifica que se iniciará una actividad esperando un resultado.</li>
<li><strong><code>ActivityResultCallback&lt;ActivityResult&gt;()</code></strong>: Define cómo manejar el resultado una vez que la actividad finalice.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Callback <code>onActivityResult(ActivityResult result)</code></strong>:</p>
<ul>
<li><strong>Verificación del Resultado</strong>:<!-- -->
<ul>
<li><strong>Éxito (<code>RESULT_OK</code>)</strong>:<!-- -->
<ul>
<li><strong>Obtención de Datos</strong>: Se extrae la <code>Intent</code> que contiene la información de la cuenta de Google.</li>
<li><strong>Extracción de la Cuenta</strong>: Utiliza <code>GoogleSignIn.getSignedInAccountFromIntent(data)</code> para obtener la cuenta de Google del usuario.</li>
<li><strong>Autenticación con Firebase</strong>: Si la cuenta es válida, se llama al método <code>autenticarConFirebaseGoogle(account.getIdToken())</code> para autenticar al usuario en Firebase usando el token de Google.</li>
</ul>
</li>
<li><strong>Cancelación o Error</strong>: Si el usuario canceló el inicio de sesión o ocurrió un error, se muestra un mensaje adecuado.</li>
</ul>
</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="método-iniciarsignincongoogle">Método <code>iniciarSignInConGoogle()</code><a href="#método-iniciarsignincongoogle" class="hash-link" aria-label="Enlace directo al método-iniciarsignincongoogle" title="Enlace directo al método-iniciarsignincongoogle">​</a></h4><p>Este método inicia el flujo de inicio de sesión con Google al lanzar la <code>Intent</code> de Google Sign-In:</p><ul>
<li>
<p><strong><code>mGoogleSignInClient.getSignInIntent()</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Crea una <code>Intent</code> que inicia el flujo de Google Sign-In.</li>
<li><strong>Uso</strong>: Esta <code>Intent</code> se utiliza para mostrar la interfaz de inicio de sesión de Google al usuario.</li>
</ul>
</li>
<li>
<p><strong><code>googleSignInLauncher.launch(signInIntent)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Inicia la <code>Intent</code> de Google Sign-In utilizando el <code>ActivityResultLauncher</code> previamente registrado.</li>
<li><strong>Beneficio</strong>: Permite manejar el resultado del inicio de sesión de manera asíncrona y sin utilizar métodos obsoletos como <code>startActivityForResult()</code>.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="método-autenticarconfirebasegooglestring-idtoken">Método <code>autenticarConFirebaseGoogle(String idToken)</code><a href="#método-autenticarconfirebasegooglestring-idtoken" class="hash-link" aria-label="Enlace directo al método-autenticarconfirebasegooglestring-idtoken" title="Enlace directo al método-autenticarconfirebasegooglestring-idtoken">​</a></h4><p>Este método autentica al usuario en Firebase utilizando el ID Token obtenido de Google Sign-In:</p><ul>
<li>
<p><strong><code>GoogleAuthProvider.getCredential(idToken, null)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Crea una instancia de <code>AuthCredential</code> utilizando el ID Token obtenido de Google Sign-In.</li>
<li><strong>Parámetros</strong>:<!-- -->
<ul>
<li><strong><code>idToken</code></strong>: El token de ID obtenido después de que el usuario inicia sesión con Google.</li>
<li><strong><code>null</code></strong>: El segundo parámetro es para el access token, que no es necesario en este caso.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>mAuth.signInWithCredential(credential)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Inicia el proceso de autenticación en Firebase utilizando las credenciales de Google.</li>
<li><strong>Proceso</strong>:<!-- -->
<ul>
<li><strong>Éxito</strong>:<!-- -->
<ul>
<li><strong>Obtención del Usuario</strong>: Se obtiene el usuario actual autenticado en Firebase.</li>
<li><strong>Mensaje de Bienvenida</strong>: Se muestra un <code>Toast</code> con un mensaje de bienvenida.</li>
<li><strong>Navegación</strong>: Se llama al método <code>iniciarMainActivity()</code> para navegar a la actividad principal de la aplicación.</li>
</ul>
</li>
<li><strong>Error</strong>:<!-- -->
<ul>
<li><strong>Mensaje de Error</strong>: Se muestra un <code>Toast</code> con el mensaje de error detallado.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-modificar-la-mainactivity">7. <strong>Modificar la <code>MainActivity</code></strong><a href="#7-modificar-la-mainactivity" class="hash-link" aria-label="Enlace directo al 7-modificar-la-mainactivity" title="Enlace directo al 7-modificar-la-mainactivity">​</a></h2>
<p>Será necesario modificar la MainActivity para incluir la posibilidad del cierre de la sesión con el usuario google ya que sigue un proceso diferente al usuario básico:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="código-completo-1">Código Completo<a href="#código-completo-1" class="hash-link" aria-label="Enlace directo al Código Completo" title="Enlace directo al Código Completo">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">MainActivity.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">com</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">agora</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">autenticaciondemo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">androidx</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">appcompat</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">app</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">AppCompatActivity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">content</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Intent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">os</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Bundle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">util</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Log</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">view</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">View</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">widget</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Toast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">agora</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">autenticaciondemo</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">databinding</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">ActivityMainBinding</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">gms</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">api</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">signin</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">GoogleSignIn</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">gms</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">api</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">signin</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">GoogleSignInClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">android</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">gms</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">api</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">signin</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">GoogleSignInOptions</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">firebase</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">FirebaseAuth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">firebase</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">FirebaseUser</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">google</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">firebase</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">auth</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">FirebaseUserMetadata</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">util</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Date</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * MainActivity muestra información del usuario y permite cerrar sesión.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MainActivity</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">AppCompatActivity</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// View Binding para activity_main.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">ActivityMainBinding</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Referencia a FirebaseAuth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">FirebaseAuth</span><span class="token plain"> mAuth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Referencia a usuario Google</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">GoogleSignInClient</span><span class="token plain"> mGoogleSignInClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Bundle</span><span class="token plain"> savedInstanceState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">onCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">savedInstanceState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Inicializamos el binding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        binding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ActivityMainBinding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inflate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getLayoutInflater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">View</span><span class="token plain"> view </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setContentView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">view</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Obtener instancia de FirebaseAuth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mAuth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">FirebaseAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Configurar Google Sign-In</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">configurarGoogleSignIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Verificar si hay un usuario logueado</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">FirebaseUser</span><span class="token plain"> usuarioActual </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCurrentUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usuarioActual </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Si no hay usuario, volvemos a RegistroActivity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">volverRegistro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//Mostramos email del usuario</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textViewUserInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usuarioActual</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Obtener la metadata del usuario</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">FirebaseUserMetadata</span><span class="token plain"> metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> usuarioActual</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMetadata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metadata </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Obtener la fecha de creación y último inicio de sesión</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> creationTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCreationTimestamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Milisegundos desde la época Unix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> lastSignInTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLastSignInTimestamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Milisegundos desde la época Unix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// Para mostrarlo de forma legible, podemos convertirlo a Date:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">Date</span><span class="token plain"> creationDate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">creationTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">Date</span><span class="token plain"> lastSignInDate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lastSignInTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">//Mostramos información del usuario</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textViewUserInfo2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Cuenta creada: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> creationDate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textViewUserInfo3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Última sesión: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> lastSignInDate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Evento para botón &quot;Cerrar Sesión&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        binding</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">buttonLogout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setOnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">View</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">View</span><span class="token plain"> view</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">signOutUsuario</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Configura las opciones de Google Sign-In.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">configurarGoogleSignIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">GoogleSignInOptions</span><span class="token plain"> gso </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">GoogleSignInOptions</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Builder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GoogleSignInOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DEFAULT_SIGN_IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">requestIdToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">getString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">default_web_client_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ID del cliente web de Firebase</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">requestEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Solicitar el email del usuario</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        mGoogleSignInClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GoogleSignIn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gso</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Cierra la sesión del usuario.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">signOutUsuario</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signOut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        mGoogleSignInClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signOut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addOnCompleteListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isSuccessful</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MainActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Sesión cerrada correctamente&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Navegar a RegistroActivity</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Intent</span><span class="token plain"> intent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Intent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MainActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">startActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">intent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Finalizar MainActivity</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">makeText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MainActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Error al cerrar sesión de Google&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Toast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LENGTH_SHORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Volver a la pantalla de registro/inicio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">volverRegistro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Navegar a RegisterActivity.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">volverRegistro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Intent</span><span class="token plain"> intent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Intent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MainActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">RegistroActivity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">startActivity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">intent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Cerramos la actividad actual</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Cuando el usuario sale de la app (onDestroy se llama cuando la Activity se destruye),</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * cerramos sesión automáticamente según la solicitud.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onDestroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">onDestroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Cerrar sesión automáticamente al destruir la Activity (salir de la app)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signOut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Cerrar sesión en Google</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        mGoogleSignInClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">signOut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="explicación-detallada-1">Explicación detallada<a href="#explicación-detallada-1" class="hash-link" aria-label="Enlace directo al Explicación detallada" title="Enlace directo al Explicación detallada">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>A continuación, se desarrolla una <strong>explicación detallada</strong> de las <strong>partes resaltadas</strong> en tu código <code>MainActivity.java</code>. Estas secciones son fundamentales para implementar correctamente la <strong>cerrar sesión</strong> tanto para usuarios básicos como para usuarios que han iniciado sesión con <strong>Google Sign-In</strong>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="declaración-de-variables-clave-1">Declaración de Variables Clave<a href="#declaración-de-variables-clave-1" class="hash-link" aria-label="Enlace directo al Declaración de Variables Clave" title="Enlace directo al Declaración de Variables Clave">​</a></h4><p>En tu clase <code>MainActivity</code>, has declarado dos variables clave que son esenciales para manejar el <strong>cierre de sesión</strong> de usuarios que han iniciado sesión con <strong>Google</strong>:</p><ul>
<li><strong><code>GoogleSignInClient mGoogleSignInClient</code></strong>:<!-- -->
<ul>
<li><strong>¿Qué es?</strong>: Es una instancia de <code>GoogleSignInClient</code> que gestiona las interacciones con los servicios de <strong>Google Sign-In</strong>.</li>
<li><strong>Función</strong>: Permite iniciar y cerrar sesiones de <strong>Google Sign-In</strong>. En este contexto, se utiliza principalmente para cerrar la sesión del usuario cuando este decide hacerlo desde la aplicación.</li>
<li><strong>Importancia</strong>: Es necesario mantener una referencia a <code>GoogleSignInClient</code> para poder invocar métodos como <code>signOut()</code> y <code>revokeAccess()</code>, que gestionan la autenticación con Google.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuración-de-google-sign-in-1">Configuración de Google Sign-In<a href="#configuración-de-google-sign-in-1" class="hash-link" aria-label="Enlace directo al Configuración de Google Sign-In" title="Enlace directo al Configuración de Google Sign-In">​</a></h4><p>Dentro del método <code>onCreate()</code>, llamas al método <code>configurarGoogleSignIn()</code> para establecer las opciones de <strong>Google Sign-In</strong>:</p><ul>
<li><strong><code>configurarGoogleSignIn()</code></strong>:<!-- -->
<ul>
<li><strong>Propósito</strong>: Configura las opciones necesarias para <strong>Google Sign-In</strong>, tales como solicitar el <strong>ID Token</strong> y el <strong>email</strong> del usuario.</li>
<li><strong>Importancia</strong>: Establece las configuraciones que permiten a tu aplicación comunicarse correctamente con los servicios de Google y Firebase para la autenticación.</li>
<li><strong>Ubicación</strong>: Este método se llama en el <code>onCreate()</code> para asegurarse de que la configuración se realice al iniciar la actividad.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="método-configurargooglesignin-1">Método <code>configurarGoogleSignIn()</code><a href="#método-configurargooglesignin-1" class="hash-link" aria-label="Enlace directo al método-configurargooglesignin-1" title="Enlace directo al método-configurargooglesignin-1">​</a></h4><p>Este método configura las opciones de <strong>Google Sign-In</strong> y crea una instancia de <code>GoogleSignInClient</code> con dichas opciones:</p><ul>
<li>
<p><strong><code>GoogleSignInOptions.Builder</code></strong>:</p>
<ul>
<li><strong><code>GoogleSignInOptions.DEFAULT_SIGN_IN</code></strong>: Configura el inicio de sesión de Google con las opciones predeterminadas, que incluyen solicitar el <strong>ID Token</strong> y el <strong>email</strong> del usuario.</li>
<li><strong><code>requestIdToken(getString(R.string.default_web_client_id))</code></strong>:<!-- -->
<ul>
<li><strong>Propósito</strong>: Solicita un <strong>ID Token</strong> que es necesario para autenticar al usuario con <strong>Firebase Authentication</strong>.</li>
<li><strong><code>default_web_client_id</code></strong>: Es un string que contiene el ID del cliente web generado por Firebase. Este valor debe estar definido en tu archivo <code>res/values/strings.xml</code> y se obtiene automáticamente al configurar <strong>Google Sign-In</strong> en la consola de Firebase.</li>
</ul>
</li>
<li><strong><code>requestEmail()</code></strong>:<!-- -->
<ul>
<li><strong>Propósito</strong>: Solicita el email del usuario, que es necesario para identificar al usuario en <strong>Firebase</strong>.</li>
</ul>
</li>
<li><strong><code>build()</code></strong>:<!-- -->
<ul>
<li><strong>Función</strong>: Construye las opciones de <strong>Google Sign-In</strong> con las configuraciones especificadas.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>GoogleSignIn.getClient(this, gso)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Crea una instancia de <code>GoogleSignInClient</code> utilizando las opciones configuradas (<code>gso</code>).</li>
<li><strong>Uso</strong>: Esta instancia se utiliza para iniciar y cerrar el flujo de <strong>Google Sign-In</strong>.</li>
</ul>
</li>
</ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="método-signoutusuario">Método <code>signOutUsuario()</code><a href="#método-signoutusuario" class="hash-link" aria-label="Enlace directo al método-signoutusuario" title="Enlace directo al método-signoutusuario">​</a></h4><p>Este método maneja el <strong>cierre de sesión</strong> del usuario, tanto en <strong>Firebase Authentication</strong> como en <strong>Google Sign-In</strong>:</p><ul>
<li>
<p><strong><code>mAuth.signOut()</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Cierra la sesión del usuario en <strong>Firebase Authentication</strong>.</li>
<li><strong>Importancia</strong>: Es esencial para asegurarse de que el usuario ya no tenga acceso a los recursos protegidos de la aplicación.</li>
</ul>
</li>
<li>
<p><strong><code>mGoogleSignInClient.signOut().addOnCompleteListener(this, task -&gt; { ... })</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Cierra la sesión del usuario en <strong>Google Sign-In</strong> de manera asíncrona.</li>
<li><strong><code>addOnCompleteListener</code></strong>:<!-- -->
<ul>
<li><strong>Propósito</strong>: Permite manejar el resultado de la operación de cierre de sesión.</li>
<li><strong>Éxito (<code>task.isSuccessful()</code>)</strong>:<!-- -->
<ul>
<li><strong>Acciones</strong>:<!-- -->
<ul>
<li>Muestra un mensaje <code>Toast</code> indicando que la sesión se cerró correctamente.</li>
<li>Navega a <code>RegistroActivity</code> para que el usuario pueda iniciar sesión nuevamente si lo desea.</li>
<li>Finaliza <code>MainActivity</code> con <code>finish()</code> para evitar que el usuario pueda regresar a esta actividad mediante el botón &quot;Atrás&quot;.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Error</strong>:<!-- -->
<ul>
<li>Muestra un mensaje <code>Toast</code> indicando que hubo un error al cerrar la sesión de Google.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>volverRegistro()</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Método adicional que navega a <code>RegistroActivity</code>. Aunque ya navegas a <code>RegistroActivity</code> dentro del <code>addOnCompleteListener</code>, esta llamada podría ser redundante o depender de la lógica específica de tu aplicación.</li>
</ul>
</li>
</ul><blockquote>
<p><strong>Nota Importante</strong>: Asegúrate de manejar adecuadamente la navegación para evitar que la actividad se cierre dos veces o que el usuario quede en un estado inconsistente.</p>
</blockquote><hr><h4 class="anchor anchorWithStickyNavbar_LWe7" id="método-ondestroy">Método <code>onDestroy()</code><a href="#método-ondestroy" class="hash-link" aria-label="Enlace directo al método-ondestroy" title="Enlace directo al método-ondestroy">​</a></h4><p>Este método maneja el <strong>cierre de sesión automático</strong> cuando la actividad es destruida (por ejemplo, al cerrar la aplicación):</p><ul>
<li>
<p><strong><code>mAuth.signOut()</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Cierra la sesión del usuario en <strong>Firebase Authentication</strong>.</li>
<li><strong>Importancia</strong>: Garantiza que el usuario no permanezca autenticado después de que la actividad haya sido destruida.</li>
</ul>
</li>
<li>
<p><strong><code>mGoogleSignInClient.signOut()</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Cierra la sesión del usuario en <strong>Google Sign-In</strong> de manera síncrona.</li>
<li><strong>Importancia</strong>: Asegura que el usuario ya no esté autenticado con su cuenta de Google en la aplicación.</li>
<li><strong>Consideración</strong>:<!-- -->
<ul>
<li><strong>Impacto en la Experiencia del Usuario</strong>: Implementar el cierre de sesión automático en <code>onDestroy()</code> significa que cada vez que la actividad sea destruida (incluyendo rotaciones de pantalla, cambios de configuración, o al cerrar la aplicación), la sesión del usuario será cerrada. Esto podría resultar molesto para el usuario, ya que tendría que iniciar sesión cada vez que abre la aplicación.</li>
<li><strong>Recomendación</strong>: Evalúa si realmente deseas cerrar la sesión automáticamente al destruir la actividad. Generalmente, las sesiones se mantienen activas hasta que el usuario decide cerrarlas manualmente para proporcionar una mejor experiencia de usuario.</li>
</ul>
</li>
</ul>
</li>
</ul></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prueba-la-aplicación"><strong>Prueba la aplicación</strong><a href="#prueba-la-aplicación" class="hash-link" aria-label="Enlace directo al prueba-la-aplicación" title="Enlace directo al prueba-la-aplicación">​</a></h2>
<p>Felicidades 👏🏽👏🏽. En este punto deberías tener una App que permita el login y registro de usuarios mediante dos métodos distintos. 🚀</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Página del documento"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Autentication/ejemplo"><div class="pagination-nav__sublabel">Anterior</div><div class="pagination-nav__label">Ejemplo Email-Password</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/aplicaciones móviles/5 Persistencia/FireBase/Real Time Database"><div class="pagination-nav__sublabel">Siguiente</div><div class="pagination-nav__label">5.4.2 Real Time DataBase</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-habilitar-google-como-proveedor" class="table-of-contents__link toc-highlight">1. <strong>Habilitar Google como proveedor</strong></a></li><li><a href="#2-agregar-huellas-digitales-a-tu-proyecto" class="table-of-contents__link toc-highlight">2. <strong>Agregar huellas digitales a tu proyecto</strong></a><ul><li><a href="#por-qué-son-necesarias-las-huellas-digitales" class="table-of-contents__link toc-highlight">¿Por qué son necesarias las huellas digitales?</a></li><li><a href="#tipos-de-huellas-digitales" class="table-of-contents__link toc-highlight">Tipos de huellas digitales</a></li><li><a href="#cómo-obtener-tus-huellas-digitales" class="table-of-contents__link toc-highlight">¿Cómo obtener tus huellas digitales?</a></li><li><a href="#cómo-se-agregan-a-firebase" class="table-of-contents__link toc-highlight">¿Cómo se agregan a Firebase?</a></li></ul></li><li><a href="#3-agregar-las-dependencias" class="table-of-contents__link toc-highlight">3. <strong>Agregar las dependencias</strong></a></li><li><a href="#4-configurar-googlesigninclient" class="table-of-contents__link toc-highlight">4. <strong>Configurar GoogleSignInClient</strong></a></li><li><a href="#5-añadir-un-botón-para-iniciar-sesión-con-google" class="table-of-contents__link toc-highlight">5. <strong>Añadir un botón para Iniciar sesión con Google</strong></a></li><li><a href="#6-modificar-la-registroactivity" class="table-of-contents__link toc-highlight">6. <strong>Modificar la <code>RegistroActivity</code></strong></a><ul><li><a href="#código-completo" class="table-of-contents__link toc-highlight">Código completo</a></li><li><a href="#explicación-detallada" class="table-of-contents__link toc-highlight">Explicación detallada</a></li></ul></li><li><a href="#7-modificar-la-mainactivity" class="table-of-contents__link toc-highlight">7. <strong>Modificar la <code>MainActivity</code></strong></a><ul><li><a href="#código-completo-1" class="table-of-contents__link toc-highlight">Código Completo</a></li><li><a href="#explicación-detallada-1" class="table-of-contents__link toc-highlight">Explicación detallada</a></li></ul></li><li><a href="#prueba-la-aplicación" class="table-of-contents__link toc-highlight"><strong>Prueba la aplicación</strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://jamfdev.github.io/">Apuntes para Ciclos Formativos de Formación Profesional</a> por <span property="cc:attributionName">Jose A. Martínez</span>  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a></p> 
        <p>📧 jamartinezf01@educarex.es</p></div></div></div></footer></div>
</body>
</html>